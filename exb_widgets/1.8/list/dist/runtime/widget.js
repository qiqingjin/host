System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-core/react","jimu-ui/basic/sql-expression-runtime"],(function(e,t){var i={},o={},s={},n={},r={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.ClauseLogic=e.ClauseLogic,i.ClauseOperator=e.ClauseOperator,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.ExpressionResolverComponent=e.ExpressionResolverComponent,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.LayoutType=e.LayoutType,i.LinkType=e.LinkType,i.MessageManager=e.MessageManager,i.MessageType=e.MessageType,i.QueryScope=e.QueryScope,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ReactResizeDetector=e.ReactResizeDetector,i.RepeatedDataSourceProvider=e.RepeatedDataSourceProvider,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.esri=e.esri,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.utils=e.utils},function(e){o.Alert=e.Alert,o.Button=e.Button,o.DataActionDropDown=e.DataActionDropDown,o.DistanceUnits=e.DistanceUnits,o.Dropdown=e.Dropdown,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.DropdownToggle=e.DropdownToggle,o.ListGroupItem=e.ListGroupItem,o.Pagination=e.Pagination,o.Popper=e.Popper,o.SVG=e.SVG,o.TextInput=e.TextInput,o.WidgetPlaceholder=e.WidgetPlaceholder,o._Link=e._Link,o.defaultMessages=e.defaultMessages,o.styleUtils=e.styleUtils,o.utils=e.utils},function(e){s.LayoutEntry=e.LayoutEntry,s.LayoutItemSizeModes=e.LayoutItemSizeModes,s.searchUtils=e.searchUtils},function(e){n.Fragment=e.Fragment,n.PureComponent=e.PureComponent,n.createElement=e.createElement,n.forwardRef=e.forwardRef},function(e){r.SqlExpressionRuntime=e.SqlExpressionRuntime,r.updateSQLExpressionByVersion=e.updateSQLExpressionByVersion}],execute:function(){e((()=>{var e={65354:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm5-3a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2H7Zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4Zm0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2H7Zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4Zm0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2H7Zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4ZM2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm0 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z" fill="#FFF" fill-rule="nonzero"></path></svg>'},81411:e=>{e.exports='<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.5.995c0-.55-.43-.995-.96-.995H2.46a.94.94 0 0 0-.605.223 1.02 1.02 0 0 0-.14 1.4L6.5 7.72c.122.156.196.347.212.548l.835 10.815c.007.092.027.183.058.27a.951.951 0 0 0 1.237.582l2.112-.82a.99.99 0 0 0 .615-.797l1.325-10.062c.025-.193.105-.374.228-.52l5.141-6.087c.154-.181.238-.414.238-.655ZM2.5 1h14.999l-5.141 6.09-.117.153a2.016 2.016 0 0 0-.34.883l-1.325 10.062-2.035.792-.833-10.788-.02-.169a2.012 2.012 0 0 0-.402-.92L2.502 1.006 2.5 1Z" fill="#000"></path></svg>'},33869:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 7.5a.522.522 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.508.508 0 0 1-.73 0L1 7.5l4.743-4.846a.508.508 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},11407:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.538.538 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.538.538 0 0 1 .738 0Z" fill="#000"></path></svg>'},3273:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.538.538 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.538.538 0 0 1-.738 0Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},65283:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.124c.242 0 .438-.224.438-.5s-.196-.5-.438-.5H.438ZM0 7.5c0-.276.196-.5.438-.5h15.124c.242 0 .438.224.438.5s-.196.5-.438.5H.438C.196 8 0 7.776 0 7.5ZM0 13.5c0-.276.196-.5.438-.5h15.124c.242 0 .438.224.438.5s-.196.5-.438.5H.438C.196 14 0 13.776 0 13.5Z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Zm-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707l-4.137-4.137Z" fill="#000"></path></svg>'},48957:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056l2.323-2.71Zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056l2.323-2.71ZM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5ZM8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1h8Z" fill="#000"></path></svg>'},87830:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5ZM16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5ZM5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055ZM5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055Z" fill="#000"></path></svg>'},41235:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1l-.866.5Zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2-1.5 2Zm.951-4v-2H5.817l-.578-1h8.81v3h-1Z" fill="#000"></path></svg>'},60397:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6h1.049Zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11v-2Z" fill="#000"></path></svg>'},43036:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m11.366 7.841-.732-.682-3.125 3.349-1.635-1.84-.748.664 2.365 2.66 3.875-4.15Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 3V1.167C4.5.469 5.204 0 6 0h4c.796 0 1.5.47 1.5 1.167V3h4a.5.5 0 0 1 0 1H14l-.929 11.077a1 1 0 0 1-.997.923H3.926a1 1 0 0 1-.997-.923L2 4H.5a.5.5 0 0 1 0-1h4ZM3.003 4h9.994l-.923 11H3.926L3.003 4ZM10.5 1v2h-5V1c0-.04 5-.04 5 0Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},48891:e=>{"use strict";e.exports=i},51315:e=>{"use strict";e.exports=n},74758:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=o},15506:e=>{"use strict";e.exports=r}},t={};function l(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,l),s.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var a={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(a),l.d(a,{Widget:()=>It,default:()=>Rt});var e=l(48891),t=l(30726);const i=20;var o,s,n,r,c,d,h,u,p,g,m,f;!function(e){e.None="NONE",e.Arrangement="ARRANGEMENT",e.States="STATES",e.Tools="TOOLS"}(o||(o={})),function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(s||(s={})),function(e){e.None="NONE",e.Single="SINGLE",e.Multiple="MULTIPLE"}(n||(n={})),function(e){e.Scroll="SCROLL",e.MultiPage="MULTIPAGE"}(r||(r={})),function(e){e.Start="FLEX-START",e.Center="CENTER",e.End="FLEX-END"}(c||(c={})),function(e){e.Horizon="HORIZON",e.Vertical="VERTICAL"}(d||(d={})),function(e){e.Row="ROW",e.Column="COLUMN",e.GRID="GRID"}(h||(h={})),function(e){e.Glide="GLIDE",e.Fade="FADE",e.Float="FLOAT"}(u||(u={})),function(e){e.Hover0="HOVER0",e.Hover1="HOVER1",e.Hover2="HOVER2",e.Hover3="HOVER3"}(p||(p={})),function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3"}(g||(g={})),function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9"}(m||(m={})),function(e){e.Regular="REGULAR",e.Selected="SELECTED",e.Hover="HOVER"}(f||(f={}));var v=l(74758),S=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{a(o.next(e))}catch(e){n(e)}}function l(e){try{a(o.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}a((o=o.apply(e,t||[])).next())}))};function y(t,i,o){const s=i.searchFields.split(","),n=i.searchExact?e.ClauseOperator.StringOperatorIs:e.ClauseOperator.StringOperatorContains;if(i.searchOpen&&i.searchFields){const i=s.map((i=>e.dataSourceUtils.createSQLClause(i,n,t))),r=e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,i);return e.dataSourceUtils.getArcGISSQL(r,o)}}function w(e,t){if(!t)return e;const i=new RegExp(`(${t})`,"gi");return e.replace(i,"<strong >$1</strong>")}const b=e.utils.memoize((function(t){const{showTopTools:i,bottomToolH:o,topRightToolW:s,hasRecords:n,currentCardSize:l,pageStyle:a,scrollBarOpen:c,appMode:u,theme:p,isHeightAuto:g,isWidthAuto:m,listTemplateDefaultCardSize:f,layoutType:v,listLeftPadding:S}=t,y=i?42:0,w=v===h.Column?d.Horizon:d.Vertical,b=v===h.Column,x=v===h.Column?"column":"row";return e.css`
    &.list-container {
      /* position: ${g?"absolute":"relative"}; */
      position: relative;
      z-index: 0;
      overflow: hidden;
      .bottom-boundary {
        height: 2px;
        width: 2px;
        position: absolute;
        bottom: 0;
        right: 0;
        opacity: 0;
      }
      ${w===d.Horizon?`\n          margin-left: 0px;\n          height: ${g?"auto":"100%"};\n          width: ${m?"auto":"calc(100% - 0px)"};\n        `:`\n          margin-top: 0px;\n          width: ${m?"auto":"100%"};\n          height: ${g?"auto":"calc(100% - 0px)"};\n        `}

      .editing-mask-con {
        &:before {
          content: '';
          position: absolute;
          left: 0;
          top: ${y}px;
          z-index: 10;
          height: ${l.height}px;
          width: ${S}px;
          background-color: ${e.polished.rgba(p.colors.black,.2)};
        }
        .editing-mask-list-grid {
          position: absolute;
          left: ${l.width+S}px;
          top: ${y}px;
          right: 0;
          z-index: 10;
          height: ${l.height}px;
          background-color: ${e.polished.rgba(p.colors.black,.2)};
        }
      }
      .editing-mask-list {
        position: absolute;
        top: ${v!==h.Column&&n?l.height+y:y}px;
        left: ${v===h.Column&&n?l.width:0}px;
        bottom: ${e.polished.rem(o)};
        right: 0;
        z-index: 10;
        background-color: ${e.polished.rgba(p.colors.black,.2)};
      }

      .editing-mask-ds-tool {
        position: absolute;
        z-index: 10;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background-color: ${e.polished.rgba(p.colors.black,.2)};
      }

      .editing-mask-bottom-tool {
        position: absolute;
        z-index: 10;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background-color: ${e.polished.rgba(p.colors.black,.2)};
      }

      .empty-con {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        z-index: 10;
        transform: translateY(-50%);
        padding-top: ${y}px;
        .jimu-icon {
          color: ${p.colors.palette.warning[900]};
        }
        .discribtion {
          margin: ${e.polished.rem(9)} 0 ${e.polished.rem(8)} 0;
          font-size: ${e.polished.rem(14)};
          color: ${p.colors.black}
        }
        .clear-message-action-button {
          width: ${e.polished.rem(65)};
        }
      }

      .datasource-tools {
        position: relative;
        height: ${e.polished.rem(y)};
        padding-bottom: ${e.polished.rem(14)};
        .sort-fields-input {
          width: 200px;
          margin-left: 8px;
          margin-right: 16px;
        }

        .tool-row {
          height: ${28}px;
        }
        .ds-tools-line {
          width: 100%;
          height: 1px;
          margin-top: ${e.polished.rem(6)};
          background-color: ${p.colors.palette.light[500]};
        }
        .ds-tools-line-blue {
          background-color: ${p.colors.palette.info[500]};
        }
        .list-search-div {
          width: calc(100% - ${s}px);
          .list-search {
            margin-bottom: ${e.polished.rem(-4)};
            width: 100%;
          }
        }

      }
      .tools-menu {
        color: ${p.colors.palette.light[800]};
      }
      .tools-menu:hover {
        color: ${p.colors.palette.info[500]};
      }
      .bottom-tools {
        position: relative;
        padding-top: ${e.polished.rem(14)};
        min-height: ${e.polished.rem(40)};
        .scroll-navigator {
          .btn {
            border-radius: ${p.borderRadiuses.circle};
          }
        }
      }

      .widget-list-list:focus {
        outline: none;
      }
      .widget-list-list {
        & {
          padding: 0;
          position: relative;
          padding-left: ${`${S}px`};
        }
        &>div {
          position: relative;
          flex: 1;
          box-sizing: content-box;
          ${b&&`padding-right: ${e.polished.rem(15)}`};
          ${!b&&`padding-bottom: ${e.polished.rem(15)}`};
        }
        /* box-sizing: border-box; */
        ${window.jimuConfig.isInBuilder&&u!==e.AppMode.Run?"overflow: hidden !important;":`overflow-${b?"y":"x"}: hidden !important;`}
        height: ${g?"auto":`calc(100% - ${y}px - ${o}px)`} !important;
        width: ${m?"auto":"100%"} !important;
        display: flex;
        ${`flex-direction: ${x}`};
        ${g&&`min-height: ${f.height}px;`};
        ${m&&`min-width: ${f.width}px;`};
        ${b?`\n              max-width: ${t.mexSize.maxWidth}px;\n            `:`\n              max-height: calc(${t.mexSize.maxHeight} - ${y}px - ${o}px);\n            `}
      }
      ${a!==r.Scroll||c?"":"\n          .widget-list-list::-webkit-scrollbar {\n            display: none; //Safari and Chrome\n          }\n          .widget-list-list {\n              -ms-overflow-style: none; //IE 10+\n              overflow: -moz-scrollbars-none; //Firefox\n          }\n        "}
      .placeholder-alert-con {
        position: absolute;
        bottom: ${e.polished.rem(8)};
        right: ${e.polished.rem(8)};
        z-index: 11;
      }
    }
  `}));function x(t,i,o){var s,n,r,l,a,c,h,u,p,g;const{config:m,id:f,appMode:v,isHeightAuto:S,isWidthAuto:y,theme:w}=t;return e.css`
    ${"&.list-widget-"+f} {
      overflow: visible;
      background-color: transparent;
      border: ${e.polished.rem(0)} solid ${e.polished.rgba(w.colors.black,window.jimuConfig.isInBuilder&&i?.2:0)};
      height: ${S?"auto":"100%"};
      width: ${y?"auto":"100%"};
      .list-with-mask {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        top: 0;
        background-color: ${e.polished.rgba(w.colors.black,0)};
        z-index: 1;
      }
      .list-toggle-button {
        background: none;
      }
      .list-loading-con {
        min-height: ${e.polished.rem(120)};
        min-width: ${e.polished.rem(160)};
      }
      .refresh-loading-con {
        right: 0;
        bottom:${o?e.polished.rem(40):0};
        align-items: center;
        height: ${e.polished.rem(24)};
        .auto-refresh-loading {
          background: ${e.polished.rgba(null===(r=null===(n=null===(s=w.colors)||void 0===s?void 0:s.palette)||void 0===n?void 0:n.dark)||void 0===r?void 0:r[100],.2)};
          color: ${null===(l=w.colors)||void 0===l?void 0:l.black};
          font-size: ${e.polished.rem(12)};
          line-height: ${e.polished.rem(24)};
          padding: 0 ${e.polished.rem(7)};
        }
        &.horizon-loading {
          bottom:${o?e.polished.rem(46):e.polished.rem(6)};
        }
        &.vertical-loading {
          right: ${e.polished.rem(6)};
        }
      }
      .loading-con {
        @keyframes loading {
          0% {transform: rotate(0deg); };
          100% {transform: rotate(360deg)};
        }
        width: ${e.polished.rem(16)};
        height: ${e.polished.rem(16)};
        border: 1px solid ${null===(h=null===(c=null===(a=null==w?void 0:w.colors)||void 0===a?void 0:a.palette)||void 0===c?void 0:c.dark)||void 0===h?void 0:h[100]};
        border-radius: 50%;
        border-top: 1px solid ${null===(g=null===(p=null===(u=null==w?void 0:w.colors)||void 0===u?void 0:u.palette)||void 0===p?void 0:p.dark)||void 0===g?void 0:g[800]};
        box-sizing: border-box;
        animation:loading 2s infinite linear;
        margin-right: ${e.polished.rem(4)};
      }
      .widget-list {
        overflow: ${window.jimuConfig.isInBuilder&&v!==e.AppMode.Run?"hidden":"auto"};
        height: ${S?"auto":"100%"};
        width: ${y?"auto":"100%"};
        /* align-items: ${m.alignType};
        justify-content: ${m.alignType}; */
        ${m.direction===d.Horizon?"\n            overflow-y: hidden;\n          ":"\n            overflow-x: hidden;\n          "}
      }
    }

  `}function C(t){const{theme:i}=t;return e.css`
    & {
      padding: ${e.polished.rem(6)} ${e.polished.rem(11)};
      height: ${e.polished.rem(40)};
    }
    .ds-tools-line {
      width: 100%;
      height: 1px;
      background-color: ${i.colors.palette.light[500]};
    }
    .ds-tools-line-blue {
      background-color: ${i.colors.palette.info[500]};
    }
    .close-search {
      margin-top: ${e.polished.rem(-6)};
    }
  `}function I(t){const{theme:i}=t;return e.css`
    .close-search {
      border: 1px solid ${i.colors.palette.light[500]};
      box-sizing: border-box;
      background-color: ${i.colors.white};
    }
    .search-box-content {
      flex-direction: column;
      align-items: flex-start;
    }
  `}class R extends e.React.Component{constructor(){super(...arguments),this.getNewProviderData=()=>{const{widgetId:e,datasourceId:t,index:i,record:o}=this.props;return{widgetId:e,dataSourceId:t,recordIndex:i,record:o}},this.shouldComponentUpdateExcept=(e,t,i,o=[])=>{let s=!1;return this.props&&Object.keys(this.props).some((t=>!i.includes(t)&&this.props[t]!==e[t]&&(s=!0,!0))),this.state&&Object.keys(this.state).some((e=>!o.includes(e)&&this.state[e]!==t[e]&&(s=!0,!0))),s},this.isProviderEqual=(e,t)=>{let i=!0;if(e)Object.keys(e).some((o=>t?e[o]!==t[o]&&(i=!1,!0):(i=!1,!0)));else if(t)return!1;return i},this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=t=>{const{widgetId:i,selectable:o,appMode:s,theme:n}=this.props,r=this.checkIsBackgroundTransparent(t);return e.css`
      ${"&.list-card-"+i} {
        padding: 0;
        border: 0;
        background-color: transparent;
        &:focus {
          outline: ${e.polished.rem(2)} solid ${n.colors.palette.primary[700]};
          outline-offset: ${e.polished.rem(2)};
        }
        .list-card-content {
          width: 100%;
          height: 100%;
        }
      }
      &.surface-1 {
        border: none !important;
        background: ${r&&"none !important"};
      }
      .list-clear-background {
        background: transparent !important;
      }
      .list-link {
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
      }
      .list-item-con {
        overflow: hidden;
      }
      ${"&.list-card-"+i}:hover {
        ${window.jimuConfig.isInBuilder&&s!==e.AppMode.Run||!o?"":"cursor: pointer;"}
      }
      .card-editor-mask {
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 100;
      }
      .jimu-link {
        text-align: left;
      }
    `}}checkIsBackgroundTransparent(e){var t,i,o;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"===(null===(o=null===(i=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===i?void 0:i.background)||void 0===o?void 0:o.color)}}var T=l(60397),M=l.n(T);const O=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:M()},s))};var L=l(41235),j=l.n(L);const D=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:j()},s))},z=[0,5],k=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","left-start","bottom-start","top-end","top-start"]}}],P=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}],E=e.ReactRedux.connect(((t,i)=>{var o;const{selectionIsList:s,builderSupportModules:n,appMode:r,widgetId:l,browserSizeMode:a}=i;if(!window.jimuConfig.isInBuilder||r===e.AppMode.Run)return{selection:void 0,showBreak:!1};const c=null===(o=null==n?void 0:n.widgetModules)||void 0===o?void 0:o.searchUtils,d=n.jimuForBuilderLib.getAppConfigAction().appConfig,h=0===i.index&&i.selectionIsInList&&t&&t.appRuntimeInfo&&t.appRuntimeInfo.selection;return{selection:h,showBreak:!s&&h&&c&&c.getRelatedLayoutItemsInWidgetByLayoutInfo(d,h,l,a).length>1}}))(class extends R{constructor(t){super(t),this.lastResizeCall=null,this.getNewCardSize=(e,t=!1)=>{const{keepAspectRatio:i,layoutType:o,gridItemSizeRatio:s,horizontalSpace:n,isWidthPercentage:r}=this.props;let l,a=e.right-e.left;return!t&&r&&(a=e.right-e.left+n),l=o===h.GRID&&i?{width:a,height:a*s}:{width:a,height:e.bottom-e.top},l},this.handleItemClick=e=>{const{selectCard:t}=this.props;e&&e.stopPropagation(),t()},this.handleCopyTo=(t,i,o,s)=>{if(!o)return;const{layouts:n,builderSupportModules:r,browserSizeMode:l,builderStatus:a}=this.props,c=r.jimuForBuilderLib.getAppConfigAction(),d=c.appConfig,h=v.searchUtils.findLayoutId(n[a],l,d.mainSizeMode),u=v.searchUtils.findLayoutId(n[i],l,d.mainSizeMode);if(s){const t=r.widgetModules.searchUtils.getContainerLayoutItem(d.layouts[u],o.widgetId,e.LayoutItemType.Widget);t&&c.removeLayoutItem({layoutId:u,layoutItemId:t.id},!1)}c.duplicateLayoutItem(h,u,o.id,!1,s),c.exec(),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation()},this.editStatus=(t,i)=>{const{dispatch:o,widgetId:s}=this.props;o(e.appActions.widgetStatePropChange(s,t,i))},this.handleBreakLink=t=>{const{layouts:i,builderSupportModules:o,browserSizeMode:s,selection:n,builderStatus:r,dispatch:l}=this.props,a=o.jimuForBuilderLib.getAppConfigAction(),c=a.appConfig,d=v.searchUtils.findLayoutItem(c,n);if(!d)return;const h=v.searchUtils.findLayoutId(i[r],s,c.mainSizeMode);a.duplicateLayoutItem(h,h,d.id,!0),a.removeLayoutItem({layoutId:h,layoutItemId:d.id},!1),a.exec(),n.layoutId===h&&n.layoutItemId===d.id&&l(e.appActions.selectionChanged(null));const u=a.appConfig.layouts[h].content,p=Object.keys(u)[Object.keys(u).length-1];if(p){const t=u[p];l(e.appActions.selectionChanged({layoutId:h,layoutItemId:t.id}))}t.stopPropagation(),t.nativeEvent.stopImmediatePropagation()},this.getCopyDropdownItems=t=>{var i,o;const{cardConfigs:r,layouts:l,browserSizeMode:a,selection:c,builderStatus:d,builderSupportModules:h}=this.props,u=h.jimuForBuilderLib.getAppConfigAction().appConfig,p=v.searchUtils.findLayoutItem(u,c);if(!c||!p||!window.jimuConfig.isInBuilder)return{items:(0,e.Immutable)([]),title:""};const g=[];let m="",S=!0,y=r[f.Selected].selectionMode!==n.None,w=!!r[f.Hover].enable;const b=(t,i)=>h.widgetModules.searchUtils.getContentsInLayoutWithLayoutWidgetOnly(u,t,e.LayoutItemType.Widget,a).indexOf(i)>-1,x=(null===(i=r[f.Hover])||void 0===i?void 0:i.listLayout)!==(null==s?void 0:s.AUTO),C=(null===(o=r[f.Selected])||void 0===o?void 0:o.listLayout)!==(null==s?void 0:s.AUTO),I=()=>{if(r[f.Hover].enable){const e=v.searchUtils.findLayoutId(l[f.Hover],a,u.mainSizeMode);b(e,u.layouts[c.layoutId].content[c.layoutItemId].widgetId)||(w=!1),g.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,f.Hover,p,w)}})}},R=()=>{if(r[f.Selected].selectionMode!==n.None){const e=v.searchUtils.findLayoutId(l[f.Selected],a,u.mainSizeMode);b(e,u.layouts[c.layoutId].content[c.layoutItemId].widgetId)||(y=!1),g.push({label:this.formatMessage("applyTo",{status:this.formatMessage("selected").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,f.Selected,p,y)}})}},T=()=>{const e=v.searchUtils.findLayoutId(l[f.Regular],a,u.mainSizeMode);b(e,u.layouts[c.layoutId].content[c.layoutItemId].widgetId)||(S=!1),g.push({label:this.formatMessage("applyTo",{status:this.formatMessage("regular").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,f.Regular,p,S)}})};return d===f.Regular?(x&&I(),C&&R(),w&&y?m=this.formatMessage("linkedToAnd",{where1:this.formatMessage("selected").toLocaleLowerCase(),where2:this.formatMessage("hover").toLocaleLowerCase()}):w?m=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()}):y&&(m=this.formatMessage("linkedTo",{where:this.formatMessage("selected").toLocaleLowerCase()}))):d===f.Hover?(T(),R(),S&&y?m=this.formatMessage("linkedToAnd",{where1:this.formatMessage("regular").toLocaleLowerCase(),where2:this.formatMessage("selected").toLocaleLowerCase()}):S?m=this.formatMessage("linkedTo",{where:this.formatMessage("regular").toLocaleLowerCase()}):y&&(m=this.formatMessage("linkedTo",{where:this.formatMessage("selected").toLocaleLowerCase()}))):(T(),I(),S&&w?m=this.formatMessage("linkedToAnd",{where1:this.formatMessage("regular").toLocaleLowerCase(),where2:this.formatMessage("hover").toLocaleLowerCase()}):S?m=this.formatMessage("linkedTo",{where:this.formatMessage("regular").toLocaleLowerCase()}):w&&(m=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()}))),t?g.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):m=this.formatMessage("isolate"),{items:(0,e.Immutable)(g),title:m}},this._renderAction=()=>{const t=[],{theme:i,layoutType:o,keepAspectRatio:s}=this.props,n=e.css`
      box-shadow: none;

      &:after {
        position: absolute;
        content: '';
        width: ${12}px;
        height: ${12}px;
        background-color: ${i.colors.palette.primary[500]};
        border: 2px solid ${i.colors.white};
        border-radius: 50%;
        z-index: ${20};
      }
    `,r=e.css`
      box-shadow: none;
      height: ${16}px;
      left: 0px;
      right: 0px;
      bottom: ${-8}px;
      &:after {
        position: absolute;
        content: '';
        bottom: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background-color: ${i.colors.palette.primary[300]};
        z-index: ${20};
      }
    `,l=e.css`
      box-shadow: none;
      width: ${16}px;
      top: 0px;
      bottom: 0px;
      right: ${-8}px;
      &:after {
        position: absolute;
        content: '';
        right: 50%;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: ${i.colors.palette.primary[300]};
        z-index: ${20};
      }
    `,a=e.css`
      position: absolute;
    `,c=e.css`
      width: ${16}px;
      top: ${10}px;
      bottom: ${10}px;
      right: ${-8}px;

      &:after {
        top: 50%;
        right: 50%;
        margin-top: ${-5}px;
        margin-right: ${-5}px;
      }
    `,d=e.css`
      height: ${16}px;
      left: ${10}px;
      right: ${10}px;
      bottom: ${-8}px;

      &:after {
        left: 50%;
        bottom: 50%;
        margin-left: ${-5}px;
        margin-bottom: ${-5}px;
      }
    `;switch(o){case h.Column:t.push((0,e.jsx)("span",{key:"10",className:"list-card-rnd-resize-left-line",css:[a,l]})),t.push((0,e.jsx)("span",{key:"4",className:"list-card-rnd-resize-right",css:[a,n,c]}));break;case h.Row:t.push((0,e.jsx)("span",{key:"9",className:"list-card-rnd-resize-bottom-line",css:[a,r]})),t.push((0,e.jsx)("span",{key:"6",className:"list-card-rnd-resize-bottom",css:[a,n,d]}));break;case h.GRID:t.push((0,e.jsx)("span",{key:"10",className:"list-card-rnd-resize-left-line",css:[a,l]})),t.push((0,e.jsx)("span",{key:"4",className:"list-card-rnd-resize-right",css:[a,n,c]})),s||(t.push((0,e.jsx)("span",{key:"9",className:"list-card-rnd-resize-bottom-line",css:[a,r]})),t.push((0,e.jsx)("span",{key:"6",className:"list-card-rnd-resize-bottom",css:[a,n,d]})))}return t},this.getCardToolsStyle=t=>e.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{const{index:t}=this.props;if(!window.jimuConfig.isInBuilder||t>0)return;const{cardConfigs:i,appMode:o,builderSupportModules:s,datasourceId:r,selectionIsInList:l,selectionIsList:a,hideCardTool:c}=this.props;let d=!0;const{BuilderPopper:h,GLOBAL_RESIZING_CLASS_NAME:u,GLOBAL_H5_DRAGGING_CLASS_NAME:p,GLOBAL_DRAGGING_CLASS_NAME:g}=s.widgetModules;return(l||a)&&o!==e.AppMode.Run&&!c&&r||(d=!1),d&&this.props.isEditing&&(i[f.Hover].enable||i[f.Selected].selectionMode!==n.None)&&(0,e.jsx)(h,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:e.css`
            .${g} &,
            .${u} &,
            .${p} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.resizeRef.current,offset:z,modifiers:k,open:d},this.getCardMenuElement())},this.getCardMenuElement=()=>{var t;const{index:i}=this.props;if(!window.jimuConfig.isInBuilder||i>0)return;const{cardConfigs:o,selection:r,widgetId:l,builderSupportModules:a,browserSizeMode:c,builderStatus:d,selectionIsList:h}=this.props,u=a.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:p,BuilderDropDown:g,BuilderButton:m,withBuilderTheme:v}=a.widgetModules,S=h,y=!S&&r&&p&&p.getRelatedLayoutItemsInWidgetByLayoutInfo(u,r,l,c).length>1,{items:w,title:b}=this.getCopyDropdownItems(y),x=w&&w.length>0,C=(null===(t=o[d])||void 0===t?void 0:t.listLayout)||s.CUSTOM,I=!S&&(x||y)&&C===s.CUSTOM,R=v((t=>(0,e.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(t)},(0,e.jsx)(m,{active:d===f.Regular,onClick:e=>this.handleBuilderStatusChange(e,f.Regular)},this.formatMessage("regular")),o[f.Hover].enable&&(0,e.jsx)(m,{active:d===f.Hover,className:"mt-1",onClick:e=>this.handleBuilderStatusChange(e,f.Hover)},this.formatMessage("hover")),o[f.Selected].selectionMode!==n.None&&(0,e.jsx)(m,{active:d===f.Selected,className:"mt-1",onClick:e=>this.handleBuilderStatusChange(e,f.Selected)},this.formatMessage("selected")),I&&(0,e.jsx)(g,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:b,toggleType:"default",direction:"left",toggleContent:t=>y?(0,e.jsx)(O,{size:16}):(0,e.jsx)(D,{size:16}),modifiers:P,items:w}))));return(0,e.jsx)(R,null)},this.isItemAccept=(e,t)=>{var i,o;if(!e)return!1;const{isEditing:s}=this.props,n=null===(o=null===(i=e.manifest)||void 0===i?void 0:i.properties)||void 0===o?void 0:o.supportRepeat,{builderSupportModules:r,widgetId:l}=this.props,a=r.jimuForBuilderLib.getAppConfigAction().appConfig,c=r.widgetModules.selectionInList;return s&&n&&(!e.layoutInfo||e.layoutInfo&&c(e.layoutInfo,l,a,!1))},this.getEditorStyle=()=>e.css`
      &.list-card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.state={didMount:!1},this.resizeRef=e.React.createRef(),this.providerData=this.getNewProviderData()}shouldComponentUpdate(t,i){let o=this.shouldComponentUpdateExcept(t,i,["listStyle","selection"]);if(o=o||!e.utils.isDeepEqual(this.props.listStyle,t.listStyle),!o){const{selectionIsInList:i,selectionIsList:s}=this.props;(s||i)&&(o=!e.utils.isDeepEqual(this.props.selection,t.selection))}return o}componentDidUpdate(e){const{selectionIsInList:t,isEditing:i,layoutType:o,isRTL:s,lockItemRatio:n,keepAspectRatio:r,index:l}=this.props;window.jimuConfig.isInBuilder&&0===l&&this.interactable&&(i&&!t?o===h.GRID?(this.interactable.resizable({edges:{top:!1,left:s,bottom:!r,right:!s}}),this.interactable.resizable(!0)):n||(this.interactable.resizable({edges:{top:!1,left:o===h.Column&&s,bottom:o===h.Row,right:o===h.Column&&!s}}),this.interactable.resizable(!0)):this.interactable.resizable(!1))}componentDidMount(){const{index:e,layoutType:t,updateCardToolPosition:o,keepAspectRatio:s}=this.props;if(0===e&&window.jimuConfig.isInBuilder&&this.resizeRef.current){const{interact:e,handleResizeCard:n,isRTL:r}=this.props;this.interactable=e(this.resizeRef.current).resizable({edges:{top:!1,left:(t===h.Column||t===h.GRID)&&r,bottom:t===h.Row||t===h.GRID&&!s,right:(t===h.Column||t===h.GRID)&&!r},modifiers:[e.modifiers.restrictEdges({endOnly:!0}),e.modifiers.restrictSize({min:{width:i,height:i}})],inertia:!1,onstart:e=>{const{changeIsResizingCard:t}=this.props;t&&t(!0),e.stopPropagation()},onmove:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall);const t=e.rect,i=this.getNewCardSize(t,!0);o(),this.lastResizeCall=requestAnimationFrame((()=>{const e={};n(i,!1,e.top,e.left)}))},onend:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.lastResizeCall=requestAnimationFrame((()=>{const t=e.rect,i=this.getNewCardSize(t);n(i,!0);const{changeIsResizingCard:o}=this.props;o&&o(!1)}))}})}this.setState({didMount:!0})}componentWillUnMount(){this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.interactable&&(this.interactable.unset(),this.interactable=null)}handleBuilderStatusChange(e,t){this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t);const{selectCard:i}=this.props;i(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){var i;const{selectable:o,active:n,cardConfigs:r,LayoutEntry:l,selectionIsInList:a,isEditing:c,widgetId:d,listStyle:u,lockItemRatio:p,builderStatus:g,layouts:m,layoutType:v}=this.props,{didMount:S}=this.state,y=m[g],w=(null===(i=r[g])||void 0===i?void 0:i.listLayout)||s.CUSTOM,b=m[f.Regular],x=w===s.AUTO?b:y,C=r[g].backgroundStyle,I=w===s.AUTO&&g!==f.Regular,R=Object.assign({},t.styleUtils.toCSSStyle(C||{})),T=Object.assign({},t.styleUtils.toCSSStyle({borderRadius:(null==C?void 0:C.borderRadius)||0}||{})),M=this.getNewProviderData();this.isProviderEqual(M,this.providerData)||(this.providerData=M);const O=v!==h.GRID&&p;return(0,e.jsx)(e.RepeatedDataSourceProvider,{data:this.providerData},(0,e.jsx)(t.ListGroupItem,{active:o&&n,css:this.getStyle(g),style:Object.assign(Object.assign({},T),u),className:(0,e.classNames)("surface-1",`list-card-${d}`),onClick:this.handleItemClick,role:"listCardEditor"},I&&(0,e.jsx)("div",{className:"card-editor-mask position-absolute"}),S&&this.renderCardTools(),(0,e.jsx)("div",{className:"list-card-content d-flex",style:R,css:this.getEditorStyle(),ref:this.resizeRef},(0,e.jsx)(l,{isItemAccepted:this.isItemAccept,isRepeat:!0,layouts:x,isInWidget:!0}),c&&!a&&!O&&this._renderAction())))}});var N=l(51315);class A extends R{constructor(t){super(t),this.updateExpressionRecords=()=>{var e,t;this.expressionRecords={},(null===(e=this.providerData)||void 0===e?void 0:e.dataSourceId)&&(null===(t=this.providerData)||void 0===t?void 0:t.record)&&(this.expressionRecords[this.providerData.dataSourceId]=this.providerData.record)},this.onUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({url:e.value});else{const e="";this.setState({url:e})}},this.handleItemClick=e=>{const{onChange:t,active:i}=this.props,{providerData:o,linkRef:s}=this,n=e.target&&e.target.tagName||"";if("a"===n.toLowerCase()||"button"===n.toLowerCase()||"linkClick"===e.exbEventType||i||s.current&&s.current.click(),i){const i=e.target&&e.target.tagName||"";"a"!==i.toLowerCase()&&"button"!==i.toLowerCase()&&"linkClick"!==e.exbEventType&&t(o&&o.record)}else t(o&&o.record);"linkClick"===e.exbEventType&&delete e.exbEventType},this.handleLinkClick=e=>{e.stopPropagation()},this.state={url:""},this.providerData=this.getNewProviderData(),this.updateExpressionRecords(),this.layoutRef=e.React.createRef(),this.linkRef=e.React.createRef()}shouldComponentUpdate(t,i){let o=this.shouldComponentUpdateExcept(t,i,["listStyle"]);return o=o||!e.utils.isDeepEqual(this.props.listStyle,t.listStyle),o}render(){var i;const{selectable:o,active:n,cardConfigs:r,widgetId:l,listStyle:a,layouts:c,hoverLayoutOpen:d,appMode:h,isHover:u,linkParam:p,useDataSources:g,itemIdex:m,handleListMouseLeave:S,handleListMouseMove:y}=this.props;let{queryObject:w}=this.props;const{url:b}=this.state;let x,C,I,R,T=f.Regular;window.jimuConfig.isInBuilder&&h!==e.AppMode.Run?(C=r[f.Regular].backgroundStyle,x=c[f.Regular]):(x=c[f.Regular],C=r[f.Regular].backgroundStyle,p&&p.linkType&&(I=p.openType,R={linkType:p.linkType},p.linkType===e.LinkType.WebAddress?(R.value=b,w=void 0):R.value=p.value),d&&u&&c[f.Hover]&&(T=f.Hover,x=null==c?void 0:c[f.Hover],C=r[f.Hover].backgroundStyle),o&&n&&c[f.Selected]&&(T=f.Selected,x=null==c?void 0:c[f.Selected],C=r[f.Selected].backgroundStyle,w=void 0,R=void 0,I=void 0));const M=(null===(i=r[T])||void 0===i?void 0:i.listLayout)||s.CUSTOM,O=c[f.Regular],L=M===s.AUTO?O:x,j=Object.assign({},t.styleUtils.toCSSStyle(C||{})),D=Object.assign({},t.styleUtils.toCSSStyle({borderRadius:(null==C?void 0:C.borderRadius)||0}||{})),z=this.getNewProviderData();return this.isProviderEqual(z,this.providerData)||(this.providerData=z,this.updateExpressionRecords()),(0,e.jsx)(e.RepeatedDataSourceProvider,{data:this.providerData},(0,e.jsx)(t.ListGroupItem,{active:o&&n,css:this.getStyle(T),style:Object.assign(Object.assign({},a),D),className:(0,e.classNames)("surface-1",`list-card-${l}`),role:"listCardViewer",onClick:this.handleItemClick},(0,e.jsx)("div",{className:"list-card-content d-flex",onMouseLeave:S,onMouseMove:()=>{y(m)},style:j},(0,e.jsx)("div",{className:"position-relative h-100 w-100"},(0,e.jsx)(N.Fragment,null,(0,e.jsx)(t._Link,{className:"p-0 w-100 h-100 border-0 list-clear-background list-link",ref:this.linkRef,to:R,target:I,queryObject:w,onClick:this.handleLinkClick}),(0,e.jsx)("div",{className:"d-flex w-100 h-100 list-item-con",ref:this.layoutRef},(0,e.jsx)(v.LayoutEntry,{layouts:L}))))),(0,e.jsx)(e.ExpressionResolverComponent,{useDataSources:g,expression:null==p?void 0:p.expression,onChange:this.onUrlExpResolveChange,widgetId:this.props.widgetId})))}}var $=l(55339),B=l.n($);const _=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:B()},s))};var H=l(30224),U=l.n(H);const F=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:U()},s))};var W=l(33869),G=l.n(W);const V=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:G()},s))},q=new(0,e.esri.Sanitizer);class Z extends e.React.PureComponent{constructor(i){super(i),this.handleChange=e=>{this.setState({searchText:e,isShowSuggestion:(null==e?void 0:e.length)>2},(()=>{const{onSearchTextChange:t}=this.props;t&&t(e)}))},this.handleSubmit=(e,t=!1)=>{const{onSubmit:i}=this.props;i&&i(e,t)},this.onKeyUp=e=>{e&&e.target&&"Enter"===e.key&&(this.setState({isShowSuggestion:!1}),this.handleSubmit(e.target.value,!0))},this.onSuggestionConfirm=e=>{this.setState({searchText:e,isShowSuggestion:!1},(()=>{var t;this.handleSubmit(e),null===(t=this.props)||void 0===t||t.toggleSearchBoxVisible(!0)}))},this.handleClear=e=>{this.setState({searchText:""}),e.stopPropagation()},this.getStyle=()=>{var t,i,o,s,n,r,l,a,c;const{theme:d}=this.props;return e.css`
      position: relative;
      .search-input {
        margin-bottom: -1px;
        padding-left: 3px;
        border: 0;
        // border-bottom-width: 1px;
        // border-bottom-style: solid;
        // border-color: ${d.colors.primary};
        background: transparent;
        height: ${e.polished.rem(26)};
        min-width: 0;
        .input-wrapper {
          background: transparent;
          border: none;
          padding: 0;
          height: 100%;
        }
      }
      .search-input:focus {
        background: transparent;
      }
      .search-loading-con {
        @keyframes loading {
          0% {transform: rotate(0deg); };
          100% {transform: rotate(360deg)};
        }
        width: ${e.polished.rem(13)};
        height: ${e.polished.rem(13)};
        min-width: ${e.polished.rem(13)};
        border: 2px solid ${null===(o=null===(i=null===(t=null==d?void 0:d.colors)||void 0===t?void 0:t.palette)||void 0===i?void 0:i.secondary)||void 0===o?void 0:o[300]};
        border-radius: 50%;
        border-top: 2px solid ${null===(r=null===(n=null===(s=null==d?void 0:d.colors)||void 0===s?void 0:s.palette)||void 0===n?void 0:n.primary)||void 0===r?void 0:r[500]};
        box-sizing: border-box;
        animation:loading 2s infinite linear;
        margin-right: ${e.polished.rem(4)};
      }
      .clear-search, .search-back {
        cursor: pointer;
        padding: ${e.polished.rem(6)};
        background: none;
        border: none;
        color: ${null===(c=null===(a=null===(l=null==d?void 0:d.colors)||void 0===l?void 0:l.palette)||void 0===a?void 0:a.dark)||void 0===c?void 0:c[800]}
      }
      .search-back {
        margin-left: ${e.polished.rem(-6)};
      }
      .clear-search:hover {
        background: none;
      }
    `},this.getSuggestionListStyle=()=>{const{suggestionWidth:t}=this.props;return e.css`
      & {
        max-height: ${e.polished.rem(300)};
        min-width: ${e.polished.rem(t)};
        overflow: auto;
      }
      button {
        display: block;
        width: 100%;
        text-align: left;
        border: none;
        border-radius: 0;
      }
      button:hover {
        border: none;
      }
    `},this.clearSearchText=()=>{const{searchText:e}=this.state;e&&(this.handleChange(""),this.setState({isShowSuggestion:!1}))},this.getTextInputSuffixElement=()=>{const{theme:i,showLoading:o,formatMessage:s}=this.props,{searchText:n}=this.state;return(0,e.jsx)("div",{className:"d-flex align-items-center"},o&&(0,e.jsx)("div",{className:"search-loading-con"}),n&&(0,e.jsx)(t.Button,{color:"tertiary",className:"clear-search",icon:!0,size:"sm",onClick:this.clearSearchText,title:s("clearSearch")},(0,e.jsx)(_,{size:14,color:i.colors.palette.dark[800]})))},this.getTextInputPrefixElement=()=>{const{theme:i}=this.props;return(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>this.handleSubmit(this.state.searchText)},(0,e.jsx)(F,{size:16,color:i.colors.palette.light[800]}))},this.state={searchText:i.searchText||"",isShowSuggestion:!1}}componentDidUpdate(e){if(this.props.searchText!==e.searchText&&this.props.searchText!==this.state.searchText){const{searchText:e}=this.props;this.setState({searchText:e})}}render(){const{placeholder:i,className:o,showClear:s,hideSearchIcon:n,inputRef:r,onFocus:l,onBlur:a,theme:c,searchSuggestion:d,formatMessage:h,isShowBackButton:u}=this.props,{searchText:p,isShowSuggestion:g}=this.state;return(0,e.jsx)("div",null,(0,e.jsx)("div",{css:this.getStyle(),className:`d-flex align-items-center ${o}`},u&&(0,e.jsx)(t.Button,{color:"tertiary",className:"search-back",icon:!0,size:"sm",onClick:e=>{var t;null===(t=this.props)||void 0===t||t.toggleSearchBoxVisible(!1)},title:h("topToolBack")},(0,e.jsx)(V,{size:20,color:c.colors.palette.dark[800]})),(0,e.jsx)(t.TextInput,{className:"search-input flex-grow-1",ref:r,placeholder:i,onChange:e=>this.handleChange(e.target.value),onBlur:a,onFocus:l,value:p||"",onKeyDown:e=>this.onKeyUp(e),prefix:!n&&!u&&this.getTextInputPrefixElement(),suffix:this.getTextInputSuffixElement()}),s&&(0,e.jsx)(t.Button,{color:"tertiary",icon:!0,size:"sm",onClick:this.handleSubmit},(0,e.jsx)(_,{size:12,color:c.colors.palette.dark[800]}))),(0,e.jsx)("div",{ref:e=>this.reference=e},(0,e.jsx)(t.Popper,{css:this.getSuggestionListStyle(),placement:"bottom-start",reference:this.reference,offset:[0,8],open:g,trapFocus:!1,autoFocus:!1,toggle:e=>{this.setState({isShowSuggestion:!g})}},d.map(((i,o)=>{const s=q.sanitize(i.suggestionHtml);return(0,e.jsx)(t.Button,{key:o,type:"secondary",size:"sm",onClick:()=>{this.onSuggestionConfirm(i.suggestion)},dangerouslySetInnerHTML:{__html:s}})})))))}}function Q(){return Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},Q.apply(this,arguments)}function Y(e,t){return Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Y(e,t)}function K(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Y(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var J=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function ee(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!((o=e[i])===(s=t[i])||J(o)&&J(s)))return!1;var o,s;return!0}const te=function(e,t){var i;void 0===t&&(t=ee);var o,s=[],n=!1;return function(){for(var r=[],l=0;l<arguments.length;l++)r[l]=arguments[l];return n&&i===this&&t(r,s)||(o=e.apply(this,r),n=!0,i=this,s=r),o}};var ie="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function oe(e){cancelAnimationFrame(e.id)}function se(e,t){var i=ie(),o={id:requestAnimationFrame((function s(){ie()-i>=t?e.call(null):o.id=requestAnimationFrame(s)}))};return o}var ne=-1,re=null;function le(e){if(void 0===e&&(e=!1),null===re||e){var t=document.createElement("div"),i=t.style;i.width="50px",i.height="50px",i.overflow="scroll",i.direction="rtl";var o=document.createElement("div"),s=o.style;return s.width="100px",s.height="100px",t.appendChild(o),document.body.appendChild(t),t.scrollLeft>0?re="positive-descending":(t.scrollLeft=1,re=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),re}return re}var ae=function(e){var t=e.columnIndex;return e.data,e.rowIndex+":"+t};function ce(e){var t,i,o=e.getColumnOffset,s=e.getColumnStartIndexForOffset,n=e.getColumnStopIndexForStartIndex,r=e.getColumnWidth,l=e.getEstimatedTotalHeight,a=e.getEstimatedTotalWidth,c=e.getOffsetForColumnAndAlignment,d=e.getOffsetForRowAndAlignment,h=e.getRowHeight,u=e.getRowOffset,p=e.getRowStartIndexForOffset,g=e.getRowStopIndexForStartIndex,m=e.initInstanceProps,f=e.shouldResetStyleCacheOnItemSizeChange,v=e.validateProps;return i=t=function(e){function t(t){var i;return(i=e.call(this,t)||this)._instanceProps=m(i.props,X(X(i))),i._resetIsScrollingTimeoutId=null,i._outerRef=void 0,i.state={instance:X(X(i)),isScrolling:!1,horizontalScrollDirection:"forward",scrollLeft:"number"==typeof i.props.initialScrollLeft?i.props.initialScrollLeft:0,scrollTop:"number"==typeof i.props.initialScrollTop?i.props.initialScrollTop:0,scrollUpdateWasRequested:!1,verticalScrollDirection:"forward"},i._callOnItemsRendered=void 0,i._callOnItemsRendered=te((function(e,t,o,s,n,r,l,a){return i.props.onItemsRendered({overscanColumnStartIndex:e,overscanColumnStopIndex:t,overscanRowStartIndex:o,overscanRowStopIndex:s,visibleColumnStartIndex:n,visibleColumnStopIndex:r,visibleRowStartIndex:l,visibleRowStopIndex:a})})),i._callOnScroll=void 0,i._callOnScroll=te((function(e,t,o,s,n){return i.props.onScroll({horizontalScrollDirection:o,scrollLeft:e,scrollTop:t,verticalScrollDirection:s,scrollUpdateWasRequested:n})})),i._getItemStyle=void 0,i._getItemStyle=function(e,t){var s,n=i.props,l=n.columnWidth,a=n.direction,c=n.rowHeight,d=i._getItemStyleCache(f&&l,f&&a,f&&c),p=e+":"+t;if(d.hasOwnProperty(p))s=d[p];else{var g=o(i.props,t,i._instanceProps),m="rtl"===a;d[p]=s={position:"absolute",left:m?void 0:g,right:m?g:void 0,top:u(i.props,e,i._instanceProps),height:h(i.props,e,i._instanceProps),width:r(i.props,t,i._instanceProps)}}return s},i._getItemStyleCache=void 0,i._getItemStyleCache=te((function(e,t,i){return{}})),i._onScroll=function(e){var t=e.currentTarget,o=t.clientHeight,s=t.clientWidth,n=t.scrollLeft,r=t.scrollTop,l=t.scrollHeight,a=t.scrollWidth;i.setState((function(e){if(e.scrollLeft===n&&e.scrollTop===r)return null;var t=i.props.direction,c=n;if("rtl"===t)switch(le()){case"negative":c=-n;break;case"positive-descending":c=a-s-n}c=Math.max(0,Math.min(c,a-s));var d=Math.max(0,Math.min(r,l-o));return{isScrolling:!0,horizontalScrollDirection:e.scrollLeft<n?"forward":"backward",scrollLeft:c,scrollTop:d,verticalScrollDirection:e.scrollTop<r?"forward":"backward",scrollUpdateWasRequested:!1}}),i._resetIsScrollingDebounced)},i._outerRefSetter=function(e){var t=i.props.outerRef;i._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},i._resetIsScrollingDebounced=function(){null!==i._resetIsScrollingTimeoutId&&oe(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=se(i._resetIsScrolling,150)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},(function(){i._getItemStyleCache(-1)}))},i}K(t,e),t.getDerivedStateFromProps=function(e,t){return de(e,t),v(e),null};var i=t.prototype;return i.scrollTo=function(e){var t=e.scrollLeft,i=e.scrollTop;void 0!==t&&(t=Math.max(0,t)),void 0!==i&&(i=Math.max(0,i)),this.setState((function(e){return void 0===t&&(t=e.scrollLeft),void 0===i&&(i=e.scrollTop),e.scrollLeft===t&&e.scrollTop===i?null:{horizontalScrollDirection:e.scrollLeft<t?"forward":"backward",scrollLeft:t,scrollTop:i,scrollUpdateWasRequested:!0,verticalScrollDirection:e.scrollTop<i?"forward":"backward"}}),this._resetIsScrollingDebounced)},i.scrollToItem=function(e){var t=e.align,i=void 0===t?"auto":t,o=e.columnIndex,s=e.rowIndex,n=this.props,r=n.columnCount,h=n.height,u=n.rowCount,p=n.width,g=this.state,m=g.scrollLeft,f=g.scrollTop,v=function(e){if(void 0===e&&(e=!1),-1===ne||e){var t=document.createElement("div"),i=t.style;i.width="50px",i.height="50px",i.overflow="scroll",document.body.appendChild(t),ne=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return ne}();void 0!==o&&(o=Math.max(0,Math.min(o,r-1))),void 0!==s&&(s=Math.max(0,Math.min(s,u-1)));var S=l(this.props,this._instanceProps),y=a(this.props,this._instanceProps)>p?v:0,w=S>h?v:0;this.scrollTo({scrollLeft:void 0!==o?c(this.props,o,i,m,this._instanceProps,w):m,scrollTop:void 0!==s?d(this.props,s,i,f,this._instanceProps,y):f})},i.componentDidMount=function(){var e=this.props,t=e.initialScrollLeft,i=e.initialScrollTop;if(null!=this._outerRef){var o=this._outerRef;"number"==typeof t&&(o.scrollLeft=t),"number"==typeof i&&(o.scrollTop=i)}this._callPropsCallbacks()},i.componentDidUpdate=function(){var e=this.props.direction,t=this.state,i=t.scrollLeft,o=t.scrollTop;if(t.scrollUpdateWasRequested&&null!=this._outerRef){var s=this._outerRef;if("rtl"===e)switch(le()){case"negative":s.scrollLeft=-i;break;case"positive-ascending":s.scrollLeft=i;break;default:var n=s.clientWidth,r=s.scrollWidth;s.scrollLeft=r-n-i}else s.scrollLeft=Math.max(0,i);s.scrollTop=Math.max(0,o)}this._callPropsCallbacks()},i.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&oe(this._resetIsScrollingTimeoutId)},i.render=function(){var e=this.props,t=e.children,i=e.className,o=e.columnCount,s=e.direction,n=e.height,r=e.innerRef,c=e.innerElementType,d=e.innerTagName,h=e.itemData,u=e.itemKey,p=void 0===u?ae:u,g=e.outerElementType,m=e.outerTagName,f=e.rowCount,v=e.style,S=e.useIsScrolling,y=e.width,w=this.state.isScrolling,b=this._getHorizontalRangeToRender(),x=b[0],C=b[1],I=this._getVerticalRangeToRender(),R=I[0],T=I[1],M=[];if(o>0&&f)for(var O=R;O<=T;O++)for(var L=x;L<=C;L++)M.push((0,N.createElement)(t,{columnIndex:L,data:h,isScrolling:S?w:void 0,key:p({columnIndex:L,data:h,rowIndex:O}),rowIndex:O,style:this._getItemStyle(O,L)}));var j=l(this.props,this._instanceProps),D=a(this.props,this._instanceProps);return(0,N.createElement)(g||m||"div",{className:i,onScroll:this._onScroll,ref:this._outerRefSetter,style:Q({position:"relative",height:n,width:y,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:s},v)},(0,N.createElement)(c||d||"div",{children:M,ref:r,style:{height:j,pointerEvents:w?"none":void 0,width:D}}))},i._callPropsCallbacks=function(){var e=this.props,t=e.columnCount,i=e.onItemsRendered,o=e.onScroll,s=e.rowCount;if("function"==typeof i&&t>0&&s>0){var n=this._getHorizontalRangeToRender(),r=n[0],l=n[1],a=n[2],c=n[3],d=this._getVerticalRangeToRender(),h=d[0],u=d[1],p=d[2],g=d[3];this._callOnItemsRendered(r,l,h,u,a,c,p,g)}if("function"==typeof o){var m=this.state,f=m.horizontalScrollDirection,v=m.scrollLeft,S=m.scrollTop,y=m.scrollUpdateWasRequested,w=m.verticalScrollDirection;this._callOnScroll(v,S,f,w,y)}},i._getHorizontalRangeToRender=function(){var e=this.props,t=e.columnCount,i=e.overscanColumnCount,o=e.overscanColumnsCount,r=e.overscanCount,l=e.rowCount,a=this.state,c=a.horizontalScrollDirection,d=a.isScrolling,h=a.scrollLeft,u=i||o||r||1;if(0===t||0===l)return[0,0,0,0];var p=s(this.props,h,this._instanceProps),g=n(this.props,p,h,this._instanceProps),m=d&&"backward"!==c?1:Math.max(1,u),f=d&&"forward"!==c?1:Math.max(1,u);return[Math.max(0,p-m),Math.max(0,Math.min(t-1,g+f)),p,g]},i._getVerticalRangeToRender=function(){var e=this.props,t=e.columnCount,i=e.overscanCount,o=e.overscanRowCount,s=e.overscanRowsCount,n=e.rowCount,r=this.state,l=r.isScrolling,a=r.verticalScrollDirection,c=r.scrollTop,d=o||s||i||1;if(0===t||0===n)return[0,0,0,0];var h=p(this.props,c,this._instanceProps),u=g(this.props,h,c,this._instanceProps),m=l&&"backward"!==a?1:Math.max(1,d),f=l&&"forward"!==a?1:Math.max(1,d);return[Math.max(0,h-m),Math.max(0,Math.min(n-1,u+f)),h,u]},t}(N.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,useIsScrolling:!1},i}var de=function(e,t){e.children,e.direction,e.height,e.innerTagName,e.outerTagName,e.overscanColumnsCount,e.overscanCount,e.overscanRowsCount,e.width,t.instance},he=function(e,t){return e};function ue(e){var t,i,o=e.getItemOffset,s=e.getEstimatedTotalSize,n=e.getItemSize,r=e.getOffsetForIndexAndAlignment,l=e.getStartIndexForOffset,a=e.getStopIndexForStartIndex,c=e.initInstanceProps,d=e.shouldResetStyleCacheOnItemSizeChange,h=e.validateProps;return i=t=function(e){function t(t){var i;return(i=e.call(this,t)||this)._instanceProps=c(i.props,X(X(i))),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i.state={instance:X(X(i)),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof i.props.initialScrollOffset?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=te((function(e,t,o,s){return i.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:o,visibleStopIndex:s})})),i._callOnScroll=void 0,i._callOnScroll=te((function(e,t,o){return i.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:o})})),i._getItemStyle=void 0,i._getItemStyle=function(e){var t,s=i.props,r=s.direction,l=s.itemSize,a=s.layout,c=i._getItemStyleCache(d&&l,d&&a,d&&r);if(c.hasOwnProperty(e))t=c[e];else{var h=o(i.props,e,i._instanceProps),u=n(i.props,e,i._instanceProps),p="horizontal"===r||"horizontal"===a,g="rtl"===r,m=p?h:0;c[e]=t={position:"absolute",left:g?void 0:m,right:g?m:void 0,top:p?0:h,height:p?"100%":u,width:p?u:"100%"}}return t},i._getItemStyleCache=void 0,i._getItemStyleCache=te((function(e,t,i){return{}})),i._onScrollHorizontal=function(e){var t=e.currentTarget,o=t.clientWidth,s=t.scrollLeft,n=t.scrollWidth;i.setState((function(e){if(e.scrollOffset===s)return null;var t=i.props.direction,r=s;if("rtl"===t)switch(le()){case"negative":r=-s;break;case"positive-descending":r=n-o-s}return r=Math.max(0,Math.min(r,n-o)),{isScrolling:!0,scrollDirection:e.scrollOffset<s?"forward":"backward",scrollOffset:r,scrollUpdateWasRequested:!1}}),i._resetIsScrollingDebounced)},i._onScrollVertical=function(e){var t=e.currentTarget,o=t.clientHeight,s=t.scrollHeight,n=t.scrollTop;i.setState((function(e){if(e.scrollOffset===n)return null;var t=Math.max(0,Math.min(n,s-o));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),i._resetIsScrollingDebounced)},i._outerRefSetter=function(e){var t=i.props.outerRef;i._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},i._resetIsScrollingDebounced=function(){null!==i._resetIsScrollingTimeoutId&&oe(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=se(i._resetIsScrolling,150)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},(function(){i._getItemStyleCache(-1,null)}))},i}K(t,e),t.getDerivedStateFromProps=function(e,t){return pe(e,t),h(e),null};var i=t.prototype;return i.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},i.scrollToItem=function(e,t){void 0===t&&(t="auto");var i=this.props.itemCount,o=this.state.scrollOffset;e=Math.max(0,Math.min(e,i-1)),this.scrollTo(r(this.props,e,t,o,this._instanceProps))},i.componentDidMount=function(){var e=this.props,t=e.direction,i=e.initialScrollOffset,o=e.layout;if("number"==typeof i&&null!=this._outerRef){var s=this._outerRef;"horizontal"===t||"horizontal"===o?s.scrollLeft=i:s.scrollTop=i}this._callPropsCallbacks()},i.componentDidUpdate=function(){var e=this.props,t=e.direction,i=e.layout,o=this.state,s=o.scrollOffset;if(o.scrollUpdateWasRequested&&null!=this._outerRef){var n=this._outerRef;if("horizontal"===t||"horizontal"===i)if("rtl"===t)switch(le()){case"negative":n.scrollLeft=-s;break;case"positive-ascending":n.scrollLeft=s;break;default:var r=n.clientWidth,l=n.scrollWidth;n.scrollLeft=l-r-s}else n.scrollLeft=s;else n.scrollTop=s}this._callPropsCallbacks()},i.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&oe(this._resetIsScrollingTimeoutId)},i.render=function(){var e=this.props,t=e.children,i=e.className,o=e.direction,n=e.height,r=e.innerRef,l=e.innerElementType,a=e.innerTagName,c=e.itemCount,d=e.itemData,h=e.itemKey,u=void 0===h?he:h,p=e.layout,g=e.outerElementType,m=e.outerTagName,f=e.style,v=e.useIsScrolling,S=e.width,y=this.state.isScrolling,w="horizontal"===o||"horizontal"===p,b=w?this._onScrollHorizontal:this._onScrollVertical,x=this._getRangeToRender(),C=x[0],I=x[1],R=[];if(c>0)for(var T=C;T<=I;T++)R.push((0,N.createElement)(t,{data:d,key:u(T,d),index:T,isScrolling:v?y:void 0,style:this._getItemStyle(T)}));var M=s(this.props,this._instanceProps);return(0,N.createElement)(g||m||"div",{className:i,onScroll:b,ref:this._outerRefSetter,style:Q({position:"relative",height:n,width:S,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:o},f)},(0,N.createElement)(l||a||"div",{children:R,ref:r,style:{height:w?"100%":M,pointerEvents:y?"none":void 0,width:w?M:"100%"}}))},i._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],i=e[1],o=e[2],s=e[3];this._callOnItemsRendered(t,i,o,s)}if("function"==typeof this.props.onScroll){var n=this.state,r=n.scrollDirection,l=n.scrollOffset,a=n.scrollUpdateWasRequested;this._callOnScroll(r,l,a)}},i._getRangeToRender=function(){var e=this.props,t=e.itemCount,i=e.overscanCount,o=this.state,s=o.isScrolling,n=o.scrollDirection,r=o.scrollOffset;if(0===t)return[0,0,0,0];var c=l(this.props,r,this._instanceProps),d=a(this.props,c,r,this._instanceProps),h=s&&"backward"!==n?1:Math.max(1,i),u=s&&"forward"!==n?1:Math.max(1,i);return[Math.max(0,c-h),Math.max(0,Math.min(t-1,d+u)),c,d]},t}(N.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},i}var pe=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},ge=function(e,t,i){var o=e.itemSize,s=i.itemMetadataMap,n=i.lastMeasuredIndex;if(t>n){var r=0;if(n>=0){var l=s[n];r=l.offset+l.size}for(var a=n+1;a<=t;a++){var c=o(a);s[a]={offset:r,size:c},r+=c}i.lastMeasuredIndex=t}return s[t]},me=function(e,t,i,o,s){for(;o<=i;){var n=o+Math.floor((i-o)/2),r=ge(e,n,t).offset;if(r===s)return n;r<s?o=n+1:r>s&&(i=n-1)}return o>0?o-1:0},fe=function(e,t){var i=e.itemCount,o=t.itemMetadataMap,s=t.estimatedItemSize,n=t.lastMeasuredIndex,r=0;if(n>=i&&(n=i-1),n>=0){var l=o[n];r=l.offset+l.size}return r+(i-n-1)*s},ve=ue({getItemOffset:function(e,t,i){return ge(e,t,i).offset},getItemSize:function(e,t,i){return i.itemMetadataMap[t].size},getEstimatedTotalSize:fe,getOffsetForIndexAndAlignment:function(e,t,i,o,s){var n=e.direction,r=e.height,l=e.layout,a=e.width,c="horizontal"===n||"horizontal"===l?a:r,d=ge(e,t,s),h=fe(e,s),u=Math.max(0,Math.min(h-c,d.offset)),p=Math.max(0,d.offset-c+d.size);switch("smart"===i&&(i=o>=p-c&&o<=u+c?"auto":"center"),i){case"start":return u;case"end":return p;case"center":return Math.round(p+(u-p)/2);default:return o>=p&&o<=u?o:o<p?p:u}},getStartIndexForOffset:function(e,t,i){return function(e,t,i){var o=t.itemMetadataMap,s=t.lastMeasuredIndex;return(s>0?o[s].offset:0)>=i?me(e,t,s,0,i):function(e,t,i,o){for(var s=e.itemCount,n=1;i<s&&ge(e,i,t).offset<o;)i+=n,n*=2;return me(e,t,Math.min(i,s-1),Math.floor(i/2),o)}(e,t,Math.max(0,s),i)}(e,i,t)},getStopIndexForStartIndex:function(e,t,i,o){for(var s=e.direction,n=e.height,r=e.itemCount,l=e.layout,a=e.width,c="horizontal"===s||"horizontal"===l?a:n,d=ge(e,t,o),h=i+c,u=d.offset+d.size,p=t;p<r-1&&u<h;)p++,u+=ge(e,p,o).size;return p},initInstanceProps:function(e,t){var i={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,o){void 0===o&&(o=!0),i.lastMeasuredIndex=Math.min(i.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),o&&t.forceUpdate()},i},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}}),Se=ce({getColumnOffset:function(e,t){return t*e.columnWidth},getColumnWidth:function(e,t){return e.columnWidth},getRowOffset:function(e,t){return t*e.rowHeight},getRowHeight:function(e,t){return e.rowHeight},getEstimatedTotalHeight:function(e){var t=e.rowCount;return e.rowHeight*t},getEstimatedTotalWidth:function(e){var t=e.columnCount;return e.columnWidth*t},getOffsetForColumnAndAlignment:function(e,t,i,o,s,n){var r=e.columnCount,l=e.columnWidth,a=e.width,c=Math.max(0,r*l-a),d=Math.min(c,t*l),h=Math.max(0,t*l-a+n+l);switch("smart"===i&&(i=o>=h-a&&o<=d+a?"auto":"center"),i){case"start":return d;case"end":return h;case"center":var u=Math.round(h+(d-h)/2);return u<Math.ceil(a/2)?0:u>c+Math.floor(a/2)?c:u;default:return o>=h&&o<=d?o:h>d||o<h?h:d}},getOffsetForRowAndAlignment:function(e,t,i,o,s,n){var r=e.rowHeight,l=e.height,a=e.rowCount,c=Math.max(0,a*r-l),d=Math.min(c,t*r),h=Math.max(0,t*r-l+n+r);switch("smart"===i&&(i=o>=h-l&&o<=d+l?"auto":"center"),i){case"start":return d;case"end":return h;case"center":var u=Math.round(h+(d-h)/2);return u<Math.ceil(l/2)?0:u>c+Math.floor(l/2)?c:u;default:return o>=h&&o<=d?o:h>d||o<h?h:d}},getColumnStartIndexForOffset:function(e,t){var i=e.columnWidth,o=e.columnCount;return Math.max(0,Math.min(o-1,Math.floor(t/i)))},getColumnStopIndexForStartIndex:function(e,t,i){var o=e.columnWidth,s=e.columnCount,n=e.width,r=t*o,l=Math.ceil((n+i-r)/o);return Math.max(0,Math.min(s-1,t+l-1))},getRowStartIndexForOffset:function(e,t){var i=e.rowHeight,o=e.rowCount;return Math.max(0,Math.min(o-1,Math.floor(t/i)))},getRowStopIndexForStartIndex:function(e,t,i){var o=e.rowHeight,s=e.rowCount,n=e.height,r=t*o,l=Math.ceil((n+i-r)/o);return Math.max(0,Math.min(s-1,t+l-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.columnWidth,e.rowHeight}});class ye extends e.React.PureComponent{constructor(i){super(i),this.onDropDownToggle=e=>{e.stopPropagation();const{isDropDownOpen:t,onDropDownOpenChange:i}=this.props;if(void 0!==t)i&&i(!t);else{const{isOpen:e}=this.state;this.setState({isOpen:!e})}},this.onItemClick=(e,t)=>{const{isDropDownOpen:i,onDropDownOpenChange:o}=this.props;void 0!==i?o&&o(!1):this.setState({isOpen:!1}),t.event(e,t),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDropDownMouseClick=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getStyle=()=>{var t,i,o,s,n,r;const{theme:l}=this.props;return e.css`
      & button {
        padding: 0;
      }
      .list-toggle-button {
        background: ${null===(o=null===(i=null===(t=l.colors)||void 0===t?void 0:t.palette)||void 0===i?void 0:i.light)||void 0===o?void 0:o[500]};
        border: none;
        &:hover, &[aria-expanded="true"] {
          background: ${null===(r=null===(n=null===(s=l.colors)||void 0===s?void 0:s.palette)||void 0===n?void 0:n.light)||void 0===r?void 0:r[800]};
        }
      }
    `},this.state={isOpen:!1};const{withBuilderStyle:o}=i;this.MyDropdown=o?o(t.Dropdown):t.Dropdown,this.MyDropdownToggle=o?o(t.DropdownToggle):t.DropdownToggle,this.MyDropdownMenu=o?o(t.DropdownMenu):t.DropdownMenu,this.MyDropdownItem=o?o(t.DropdownItem):t.DropdownItem}render(){const{items:t,toggleContent:i,caret:o,toggleType:s,menuContent:n,appMode:r,modifiers:l,toggleIsIcon:a,theme:c,isDropDownOpen:d,size:h,appendToBody:u,toggleTitle:p,direction:g,menuCss:m,className:f,showActive:v,activeLabel:S,fluid:y}=this.props;let{isOpen:w}=this.state;w=void 0===d?w:d;const{MyDropdown:b,MyDropdownToggle:x,MyDropdownMenu:C,MyDropdownItem:I}=this;return(0,e.jsx)(b,{size:h,toggle:this.onDropDownToggle,direction:g,fluid:y,isOpen:w&&r!==e.AppMode.Design,className:`my-dropdown ${f}`,css:this.getStyle()},i&&(0,e.jsx)(x,{icon:a,title:p,size:h,type:s,caret:o,className:"list-toggle-button"},i&&i(c)),(0,e.jsx)(C,{appendToBody:u,modifiers:l,css:m&&m(c)},n?n(c):t&&t.asMutable().map(((t,i)=>!t.hide&&(0,e.jsx)(I,{key:i,className:"no-user-select",title:t.label,active:v&&t.label===S,onClick:e=>this.onItemClick(e,t)},t.label)))))}}var we=l(15506),be=l(81411),xe=l.n(be);const Ce=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:xe()},s))},Ie=[0,5],Re=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["bottom-start","right-end","top-start","left-start"]}}];class Te extends e.React.PureComponent{constructor(t){super(t),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.onPopperToggle=e=>{const{filter:t}=this.props,{isOpen:i}=this.state;i||this.setState({currentFilter:t}),this.setState({isOpen:!i})},this.onItemClick=(e,t)=>{this.setState({isOpen:!1}),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.handleFilterChange=e=>{this.setState({currentFilter:e})},this.handleApplyClick=e=>{const{currentFilter:t}=this.state,{handleFilterApplyChange:i,handleFilterChange:o}=this.props;o(t),i(!0),this.setState({isOpen:!1})},this.handleClearClick=e=>{const{handleFilterApplyChange:t}=this.props;t(!1),this.setState({isOpen:!1})},this.getStyle=()=>{const{theme:t}=this.props;return e.css`
      position: relative;
      .dot {
        position: absolute;
        width: 6px;
        height: 6px;
        right: -2px;
        top: 0px;
        .dot-bottom {
          width: 6px;
          height: 6px;
          background-color: transparent;
          .dot-top {
            width: 4px;
            height: 4px;
            background-color: ${t.colors.palette.dark[600]};
          }
        }
      }
      :hover {
        .dot-top {
          background-color: ${t.colors.palette.primary[500]};
        }
      }
      & .active {
        .dot-top {
          background-color: ${t.colors.white};
        }
        :hover {
          .dot-top {
            background-color: ${t.colors.white};
          }
        }
      }
    `},this.getPopperStyle=()=>e.css`
      .filter-button-con button {
        max-width: ${e.polished.rem(100)};
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .clear-button {
        margin-left: ${e.polished.rem(19)};
      }
    `,this.toggleRef=e.React.createRef(),this.state={isOpen:!1,currentFilter:t.filter}}componentDidUpdate(t){const{filter:i,appMode:o}=this.props;i!==t.filter&&this.setState({currentFilter:i}),o!==t.appMode&&o===e.AppMode.Design&&this.setState({isOpen:!1})}render(){const{filter:i,selectedDs:o,widgetId:s,title:n,applied:r}=this.props,{isOpen:l,currentFilter:a}=this.state,c=r&&(null==i?void 0:i.sql)===(null==a?void 0:a.sql);return(0,e.jsx)(N.Fragment,null,(0,e.jsx)(t.Button,{css:this.getStyle(),size:"sm",type:"tertiary",icon:!0,title:n,ref:this.toggleRef,onClick:this.onPopperToggle},(0,e.jsx)(Ce,{size:16}),r&&(0,e.jsx)("div",{className:"dot align-items-center justify-content-center"},(0,e.jsx)("div",{className:"dot-bottom rounded-circle"},(0,e.jsx)("div",{className:"dot-top rounded-circle"})))),(0,e.jsx)(t.Popper,{placement:"bottom-start",reference:this.toggleRef.current,offset:Ie,toggle:this.onPopperToggle,css:this.getPopperStyle(),open:l,modifiers:Re},(0,e.jsx)("div",{style:{padding:e.polished.rem(20),width:e.polished.rem(250)}},(0,e.jsx)("div",null,(0,e.jsx)(we.SqlExpressionRuntime,{widgetId:s,dataSource:o,expression:a,onChange:this.handleFilterChange})),(0,e.jsx)("div",{className:"d-flex w-100 mt-3 filter-button-con"},(0,e.jsx)(t.Button,{disabled:c,onClick:this.handleApplyClick,type:"primary",title:this.formatMessage("apply")},this.formatMessage("apply")),(0,e.jsx)(t.Button,{disabled:!r,onClick:this.handleClearClick,title:this.formatMessage("clear"),className:"clear-button"},this.formatMessage("clear"))))))}}var Me=l(11407),Oe=l.n(Me);const Le=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:Oe()},s))};var je=l(96009),De=l.n(je);const ze=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:De()},s))};var ke=l(3273),Pe=l.n(ke);const Ee=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:Pe()},s))};var Ne=l(59788),Ae=l.n(Ne);const $e=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:Ae()},s))};function Be(i){const{isRTL:o,totalPage:s,pageStyle:n,currentPage:l,scrollStatus:a,isScrollEnd:c,isEditing:d,showLoading:u,layoutType:p,handleScrollDown:g,handleScrollUp:m,handleSwitchPage:f,formatMessage:v}=i;return e.React.createElement("div",{className:"bottom-tools w-100 d-flex align-items-center justify-content-center pl-2 pr-2"},n===r.MultiPage?e.React.createElement(t.Pagination,{size:"sm",totalPage:s,current:l,onChangePage:f,disabled:u}):e.React.createElement("div",{className:"d-flex scroll-navigator"},e.React.createElement(t.Button,{title:v("previous"),disabled:"start"===a,type:"secondary",size:"sm",icon:!0,onClick:m},p===h.Column?e.React.createElement(Le,{size:12}):e.React.createElement(ze,{size:12})),e.React.createElement(t.Button,{title:v("next"),disabled:"end"===a||c,type:"secondary",size:"sm",style:o?{marginRight:e.polished.rem(10)}:{marginLeft:e.polished.rem(10)},icon:!0,onClick:g},p===h.Column?e.React.createElement(Ee,null):e.React.createElement($e,null))),window.jimuConfig.isInBuilder&&d&&e.React.createElement("div",{className:"editing-mask-bottom-tool"}))}var _e=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{a(o.next(e))}catch(e){n(e)}}function l(e){try{a(o.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}a((o=o.apply(e,t||[])).next())}))};const He=function(t,i){var o,s,n,r;return _e(this,void 0,void 0,(function*(){let l;const a=null===(r=null===(n=null===(s=null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appConfig)||void 0===s?void 0:s.widgets[i])||void 0===n?void 0:n.useDataSources)||void 0===r?void 0:r[0],c=e.DataSourceManager.getInstance();return t&&a&&(l=c.createDataSourceByUseDataSource(Object.assign({},a,{mainDataSourceId:a.mainDataSourceId}),"localId")),yield Promise.resolve(l)}))};class Ue extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.1.0",description:"",upgrader:(e,t)=>_e(this,void 0,void 0,(function*(){const i=e.filter;return yield He(i,t).then((t=>{let o=e;const s=i?(0,we.updateSQLExpressionByVersion)(i,"1.1.0",t):null;return o=o.set("filter",s),o}))}))},{version:"1.5.0",description:"1.5.0",upgrader:(e,t)=>_e(this,void 0,void 0,(function*(){const i=e.filter;return yield He(i,t).then((t=>{let i=e;if("boolean"!=typeof(null==e?void 0:e.isShowAutoRefresh)){const e=!!(o=t)&&((null===(s=o)||void 0===s?void 0:s.getAutoRefreshInterval())||0)>0;i=i.set("isShowAutoRefresh",e)}var o,s;return i}))}))},{version:"1.8.0",description:"1.8.0",upgrader:(e,t)=>_e(this,void 0,void 0,(function*(){let t=e;if((null==e?void 0:e.direction)&&!(null==e?void 0:e.layoutType)){const i=(null==e?void 0:e.direction)===d.Horizon?h.Column:h.Row;t=t.set("layoutType",i).set("keepAspectRatio",!1)}return t}))}]}}const Fe=new Ue;function We(e,t){return Math.abs(e-t)<1e-4}function Ge(e,o){const{config:s}=e,n=Ve(e),r=t.utils.toLinearUnit(n.width);let l=Qe(t.utils.toLinearUnit(n.width),o.width);return r.unit===t.DistanceUnits.PERCENTAGE&&(l=l-s.horizontalSpace>0?l-s.horizontalSpace:i),{width:l,height:Qe(t.utils.toLinearUnit(n.height),o.height)}}function Ve(e){var t;const{config:i,builderStatus:o,browserSizeMode:s}=e;let n=null==i?void 0:i.asMutable({deep:!0}).cardConfigs[o];n&&n.cardSize||(n=null==i?void 0:i.asMutable({deep:!0}).cardConfigs[f.Regular]);let r=null===(t=null==n?void 0:n.cardSize)||void 0===t?void 0:t[s];return r||(r=n.cardSize[Object.keys(n.cardSize)[0]]),r}function qe(e){const o=Ve(e),s={width:i,height:i},n=t.utils.toLinearUnit(o.width),r=t.utils.toLinearUnit(o.height);return n.unit===t.DistanceUnits.PERCENTAGE&&(s.width=50/n.distance*100),r.unit===t.DistanceUnits.PERCENTAGE&&(s.height=50/r.distance*100),s}function Ze(e){const{config:o}=e,s=Ve(e),n=t.utils.toLinearUnit(s.width);return n.unit===t.DistanceUnits.PERCENTAGE&&(n.distance=n.distance-o.horizontalSpace>0?n.distance-o.horizontalSpace:i),{width:n,height:t.utils.toLinearUnit(s.height)}}function Qe(e,i){return e.unit===t.DistanceUnits.PERCENTAGE?e.distance/100*i:e.distance}function Ye(e,t,i,o){const s=Ge(i,e),{config:n,isHeightAuto:l,isWidthAuto:a}=i;let c;if(n.pageStyle===r.Scroll){if(!e)return 0;switch(null==n?void 0:n.layoutType){case h.Row:if(0===e.height)return 0;l&&(t=document.body.scrollHeight),c=Math.ceil(t/(s.height+n.space))+1;break;case h.Column:if(0===e.width)return 0;let i=e.width;a&&(i=document.body.scrollWidth),c=Math.ceil(i/(s.width+n.space))+1;break;case h.GRID:if(0===e.height)return 0;l&&(t=document.body.scrollHeight),c=Math.ceil(t/(s.height+n.space))*o}n.navigatorOpen&&(c=Math.max(c,n.scrollStep))}else c=n.itemsPerPage;return c}function Ke(e,t){let i=40;return e&&(i=e.clientHeight),i=t?i:0,i}function Xe(e,t,i){const o=i?42:0;if(!e)return 0;const s=e.height-o-t;return s<0?0:s}function Je(e,t){const{config:i}=e,{datasource:o}=t;return!(!o||i.pageStyle===r.Scroll&&!i.navigatorOpen)}function et(e){return tt(e)||it(e)}function tt(e){return ot(e)||rt(e)||lt(e)||nt(e)||st(e)}function it(t){var i,o,s;const{id:n}=t,r=null===(o=null===(i=(0,e.getAppStore)())||void 0===i?void 0:i.getState())||void 0===o?void 0:o.appConfig,l=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[n];return(void 0===(null==l?void 0:l.enableDataAction)||(null==l?void 0:l.enableDataAction))&&function(e){const{useDataSources:t}=e;return!!t&&!!t[0]}(t)}function ot(e){const{config:t}=e;if(!t.sortOpen||!t.sorts||t.sorts.length<1)return!1;const i=t.sorts;let o=!1;return i.some((e=>(e.rule&&e.rule.some((e=>(e&&e.jimuFieldName&&(o=!0),o))),o))),o}function st(e){const{config:t}=e;return t.searchOpen&&t.searchFields&&""!==t.searchFields}function nt(e){const{config:t}=e;return t.filterOpen&&!!t.filter}function rt(e){const{config:t}=e;return t.showSelectedOnlyOpen&&t.cardConfigs[f.Selected].selectionMode!==n.None}function lt(e){const{config:t}=e;return t.showClearSelected&&t.cardConfigs[f.Selected].selectionMode!==n.None}var at=l(65283),ct=l.n(at);const dt=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:ct()},s))};var ht=l(87830),ut=l.n(ht),pt=l(48957),gt=l.n(pt);const mt=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component has-rtl-svg",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:ut(),srcRTL:gt()},s))};var ft=l(43036),vt=l.n(ft);const St=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:vt()},s))};var yt=l(79964),wt=l.n(yt);const bt=i=>{const{className:o}=i,s=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(i,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return e.React.createElement(t.SVG,Object.assign({className:n,src:wt()},s))};const xt={fake:!0},Ct=Object.assign({},{_widgetLabel:"List",_widgetDescription:"A widget to display data in a list view.",_action_filter_label:"Filter",_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",_layout_SELECTED_label:"Selected",applyTo:"Apply to {status}",listLoading:"Loading",pleaseSelect:"Please select",listNoData:"No data",selectSortFields:"Select sorting fields",clearFilter:"Clear filter",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a list template.",showSelected:"Show selected",clearSelected:"Clear selected",listSorting:"Sorting",listSort:"Sort",guideStep2Title:"Template",guideStep2Content:"Click on a template and click start.",guideStep3Title:"Data",guideStep3Content:"Click on select data to add a data source.",guideStep4Title:"Add new data",guideStep4Content:"Click add new data to select a web map.",guideStep5Title:"Select data",guideStep5Content:"Click the feature layer in the select data panel and close the panel.",guideStep6Title:"Data",guideStep6Content:"Specifies the data source, allows you to filter the data and limit the number of features that appear in the list.",guideStep7Title:"Arrangement",guideStep7Content:"Click the expand icon to explore the Arrangement section. In here, it allows you to define the direction, height, spacing, and paging style for your list.",guideStep8Title:"States",guideStep8Content:"Click the expand icon to explore the available States. In this section, it provides a visual representation to communicate the state of the list items. There are three states: regular, selected, and hover. By default, the selected state is always on.",guideStep9Title:"Tools",guideStep9Content:"Click the expand icon to explore the available Tools. In here, you can include search, sort, filter, and show selected tools in your list.",guideStep10Title:"Select image",guideStep10Content:"Click the image widget to configure it in the content panel.",guideStep10Title2:"Image settings",guideStep10Content2:"Allows you to select the image source and other settings for your widget.",guideStep11Title:"Select text",guideStep11Content:"Click the text widget to add attributes in the widget toolbar.",guideStep11Title2:"Text settings",guideStep11Content2:"Provides the configurations and style, including adding dynamic content from the widget toolbar. ",guideStep12Title:"End of tour",guideStep12Content:"Add other widgets to enhance your experience.",clearSearch:"Clear search",minimize:"Minimize",topToolBack:"Back",showAllListRecords:"Show all records",listDataActionLabel:"{layer} list selection",searchResult:"Search result"},t.defaultMessages);class It extends e.React.PureComponent{constructor(o){super(o),this.isFirstLoad=!0,this.isHasScrolled=!1,this.isHasRenderList=!1,this.isHasPublishMessageAction=!1,this.isSetlayout=!1,this.isHasInitCurrentCardSize=!1,this.updateWidgetRectTimeout=void 0,this.setListLayoutInWidgetState=()=>{const{layoutId:t,layoutItemId:i,id:o,selectionIsSelf:s}=this.props;t&&o&&i&&!this.isSetlayout&&s&&(this.props.dispatch(e.appActions.widgetStatePropChange(o,"layoutInfo",{layoutId:t,layoutItemId:i})),this.isSetlayout=!0)},this.getBodySize=()=>{this.bodySize={scrollWidth:document.documentElement.scrollWidth,scrollHeight:document.documentElement.scrollHeight,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight}},this.updateListInBuilder=(e,t)=>{var i;const{config:o}=this.props;if(!window.jimuConfig.isInBuilder)return!1;const s=Ge(this.props,null===(i=this.state)||void 0===i?void 0:i.widgetRect);let n=this.layoutPropertiesChange(e,t);this.updateScrollContentSize(e.config),this.pageTypeChange(e),this.useDatasourcesChange(e),n=this.listDivSizeChange(e,t,s,n),n&&this.updateCardToolPosition(),this.listSortChange(e),this.listFilterChange(e),o.cardConfigs[f.Selected].selectionMode!==e.config.cardConfigs[f.Selected].selectionMode&&this.selectRecords([])},this.layoutPropertiesChange=(e,t)=>{var i,o;const{config:s,top:n,left:r}=this.props;let l=!1;if(!window.jimuConfig.isInBuilder)return!1;let a=!1;const c=Ge(this.props,this.state.widgetRect),d=Ge(e,null==t?void 0:t.widgetRect);this.updateScrollContentSize(e.config);const u=n!==e.top||r!==e.left,p=(null==s?void 0:s.layoutType)!==e.config.layoutType,g=(m=d,f=c,!((v=s.layoutType)===h.Column?We(m.width,f.width):(v===h.Row||We(m.width,f.width))&&We(m.height,f.height)));var m,f,v;if(p||g||u)if(l=!0,g){const e={currentCardSize:c};a=!0,this.setState(e,(()=>{a&&this.refreshList()}))}else p&&this.handleResizeCard(this.state.currentCardSize,!0,!1,!1,!0);return a||((null==s?void 0:s.layoutType)===h.GRID?We(null==s?void 0:s.horizontalSpace,null===(i=e.config)||void 0===i?void 0:i.horizontalSpace)&&We(null==s?void 0:s.verticalSpace,null===(o=e.config)||void 0===o?void 0:o.verticalSpace):We(s.space,e.config.space))&&s.layoutType===e.config.layoutType||(a=!0,this.refreshList()),l},this.listDivSizeChange=(e,t,o,s)=>{var n;const{config:r,isHeightAuto:l}=this.props,{listDivSize:a}=this.state,c=Je(this.props,this.state),d=Je(e,t),u=et(this.props),p=et(e);if(c!==d||u!==p)if(l)s=!0;else if(r.layoutType===h.Column){let e=(null===(n=this.state.widgetRect)||void 0===n?void 0:n.height)||(null==a?void 0:a.clientHeight);if(e-=Ke(this.paginatorDiv.current,c)+42*(u?1:0),e<i)return;const t={height:e,width:o.width};this.handleResizeCard(t,!0,!1,!1,!0)}return s},this.appModeChange=t=>{const{appMode:i,selectionIsSelf:o,selectionStatus:s,builderStatus:n}=this.props;t.appMode!==i&&(i===e.AppMode.Run?this.editBuilderAndSettingStatus(f.Regular):(s!==n&&(s?this.editBuilderAndSettingStatus(s):o||this.editBuilderAndSettingStatus(f.Regular)),this.setState({showSelectionOnly:!1,searchText:void 0,filterApplied:!1,hoverIndex:-1},(()=>{this.scrollToIndex(0)}))))},this.pageTypeChange=e=>{const{pageStyle:t}=this.props.config;t!==e.config.pageStyle&&this.setState({page:1})},this.useDatasourcesChange=e=>{const{useDataSources:t}=this.props,i=e.useDataSources;if(t&&t[0]){const e=i&&i[0];e&&e.dataSourceId===t[0].dataSourceId||this.setState({page:1})}else this.setState({datasource:void 0})},this.listSortChange=e=>{const{config:t}=this.props;t.sortOpen&&t.sorts!==e.config.sorts&&this.setState({sortOptionName:void 0})},this.listFilterChange=e=>{const{config:t}=this.props;t.filterOpen&&t.filter!==e.config.filter&&this.setState({currentFilter:void 0,filterApplied:!1})},this.setSelectionStatus=()=>{const{id:t,selectionIsInSelf:i}=this.props;this.props.dispatch(e.appActions.widgetStatePropChange(t,"selectionIsInSelf",i))},this.updateScrollContentSize=e=>{const{config:t}=this.props,i=(null==t?void 0:t.layoutType)===h.GRID?We(null==t?void 0:t.horizontalSpace,null==e?void 0:e.horizontalSpace)&&We(null==t?void 0:t.verticalSpace,null==e?void 0:e.verticalSpace):We(t.space,e.space);t.layoutType===e.layoutType&&i||this.setScrollContentSize()},this.scrollToSelectedItems=e=>{const t=e.getSelectedRecordIds();if(this.isMySelected)return this.isMySelected=!1,void(this.lastSelectedRecordIds=t||[]);if(t&&t.length>0){let i=!0;if(this.lastSelectedRecordIds&&t.length===this.lastSelectedRecordIds.length?t.some((e=>!this.lastSelectedRecordIds.find((t=>t===e))&&(i=!1,!0))):i=!1,!i||this.needScroll){let i=-1;if(this.records&&this.records.find(((e,o)=>{var s;return(null===(s=e.getId)||void 0===s?void 0:s.call(e))===t[0]&&(i=o,!0)})),-1===i){const o=e.getRecords();if(o&&o.find(((e,o)=>{var s;return(null===(s=e.getId)||void 0===s?void 0:s.call(e))===t[0]&&(i=o,!0)})),i>-1){const e=Math.ceil((i+1)/this.getPageSize());this.needScroll=!0,this.setState({page:e})}}else this.scrollToIndex(i),this.needScroll=!1}}this.lastSelectedRecordIds=t||[]},this.onDSCreated=e=>{this.setState({datasource:e})},this.onResize=(e,t)=>{const o={width:e,height:t},{config:s}=this.props,{isResizingCard:n}=this.state;if(n)return;const r=Je(this.props,this.state),l=Ke(this.paginatorDiv.current,r),a=et(this.props),c=Xe(o,l,a),d=this.getOldCardSizeWhenResize(o),u={width:d.width,height:d.height};let p=!1;if(s.lockItemRatio&&s.layoutType!==h.GRID){const t=u.width/u.height;switch(null==s?void 0:s.layoutType){case h.Column:u.height=c,u.width=c*t,We(u.width,d.width)||(p=!0);break;case h.Row:u.height=e/t,u.width=e,We(u.height,d.height)||(p=!0)}}else switch(null==s?void 0:s.layoutType){case h.Column:u.height=c;break;case h.Row:u.width=e}u.width<i||u.height<i||0===o.width||0===o.height||(this.setState({widgetRect:o,currentCardSize:u},(()=>{this.isHasInitCurrentCardSize=!0,this.editListSizeInRunTime(o),p&&this.refreshList()})),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=void 0),s.lockItemRatio&&(this.resizeTimeout=setTimeout((()=>{this.handleResizeCard(u,!0,!1,!1,!0)}),500)),this.updateCardToolPosition(),this.setListDivSize())},this.getOldCardSizeWhenResize=e=>{const{currentCardSize:t}=this.state;return this.isHasInitCurrentCardSize?t:Ge(this.props,e)},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props,{hideCardTool:t}=this.state;e&&!t&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout((()=>{this.setState({hideCardTool:!1})}),500))},this.refreshList=(e=!0)=>{var t,i,o,s;this.listRef.current&&(null===(i=null===(t=this.listRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.resetAfterIndex)&&(null===(s=null===(o=this.listRef)||void 0===o?void 0:o.current)||void 0===s||s.resetAfterIndex(0,e))},this.isDsConfigured=()=>{const{useDataSources:e}=this.props;return!!e&&!!e[0]},this.selectRecords=t=>{const{datasource:i}=this.state;if(i)if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(this.props.id,t)),t){this.isMySelected=!0,this.isHasPublishMessageAction=!0,i.selectRecordsByIds(t.map((e=>e.getId())));const e=this.getOutputDs();e&&e.selectRecordsByIds(t.map((e=>e.getId())))}else this.isHasPublishMessageAction=!1},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Ct[e]},t),this.editStatus=(t,i)=>{const{dispatch:o,id:s}=this.props;o(e.appActions.widgetStatePropChange(s,t,i))},this.editWidgetConfig=e=>{window.jimuConfig.isInBuilder&&this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.scrollToIndex=(e,t="start")=>{const{config:i}=this.props;if(this.listRef.current)if((null==i?void 0:i.layoutType)===h.GRID){const i=this.getItemColumnCount(),o=Math.floor(e/i);this.listRef.current.scrollToItem({columnIndex:e-o*i,rowIndex:o,align:t})}else this.listRef.current.scrollToItem(e,t)},this.isEditing=()=>{const{appMode:t,config:i,selectionIsSelf:o,selectionIsInSelf:s}=this.props;return!!window.jimuConfig.isInBuilder&&(o||s)&&window.jimuConfig.isInBuilder&&t!==e.AppMode.Run&&i.isItemStyleConfirm},this.handleItemChange=e=>{const{config:t}=this.props,{datasource:i}=this.state;if(!i||!e)return;let o=i.getSelectedRecords()||[];if(t.cardConfigs[f.Selected].selectionMode&&t.cardConfigs[f.Selected].selectionMode!==n.None){const i=null==e?void 0:e.getId(),s=o.find((e=>e.getId()===i));t.cardConfigs[f.Selected].selectionMode===n.Single?s?(this.selectRecords([]),this.setState({showSelectionOnly:!1})):this.selectRecords([e]):(o=s?o.filter((e=>e.getId()!==i)):[e].concat(o),this.selectRecords(o))}},this.handleListPointerDown=e=>{this.setState({forceShowMask:!0}),this.mouseClickTimeout&&(clearTimeout(this.mouseClickTimeout),this.mouseClickTimeout=void 0),this.mouseClickTimeout=setTimeout((()=>{this.setState({forceShowMask:!1})}),200)},this.handleScrollUp=e=>{const t=this.getScrollStep();let i=this.getListVisibleStartIndex()-t;i<0&&(i=0),this.scrollToIndex(i,"start")},this.handleScrollDown=e=>{const t=this.getScrollStep(),{listVisibleStopIndex:i}=this,o=this.getListVisibleStartIndex();i+t>=this.records.length-1&&this.records.length<this.getTotalCount()?(this.isSwitchPage=!0,this.setState({page:this.state.page+1})):this.scrollToIndex(o+t,"start")},this.getScrollStep=()=>{const{scrollStep:e,layoutType:t}=this.props.config,i=this.getItemColumnCount();return t===h.GRID?e*i:e},this.handleSwitchPage=e=>{const t=this.getTotalPage();e<1||e>t||e!==this.state.page&&(this.isSwitchPage=!0,this.lastQueryStart=this.state.page,this.setState({page:e}))},this.handleListMouseLeave=()=>{this.isEditing()||this.setState({hoverIndex:-1})},this.handleListMouseMove=e=>{this.isEditing()||e!==this.state.hoverIndex&&this.setState({hoverIndex:e})},this.lastScrollOffset=0,this.handleListScroll=({scrollDirection:t,scrollOffset:i,scrollTop:o,scrollUpdateWasRequested:s})=>{var n,l;const{appMode:a,config:c}=this.props,d=this.listOutDivRef,{datasource:u,scrollStatus:p}=this.state;this.lastScrollOffset=(null==c?void 0:c.layoutType)===h.GRID?o:i,!d||(null!==(l=null===(n=this.records)||void 0===n?void 0:n.length)&&void 0!==l?l:0)<1||c.pageStyle!==r.Scroll||this.queryStatus===e.DataSourceStatus.Loading||!u||window.jimuConfig.isInBuilder&&a!==e.AppMode.Run||(this.isHasScrolled=!0,function(e,t){return!e||t<2}(d,this.lastScrollOffset)?"start"!==p&&this.setState({scrollStatus:"start"}):"mid"!==p&&this.setState({scrollStatus:"mid"}))},this.getTotalPage=()=>{const{totalCount:e}=this,{config:t}=this.props,i=e,o=Math.floor(i/t.itemsPerPage);return 0==i%t.itemsPerPage?o:o+1},this.getListVisibleStartIndex=()=>{const{lastScrollOffset:e}=this,{config:t}=this.props,i=this.itemSize(0),o=1*e/i;let s=Math.floor(o);const n=(o-s)*i,r=(null==t?void 0:t.layoutType)===h.GRID?null==t?void 0:t.verticalSpace:null==t?void 0:t.space,l=this.getItemColumnCount();return s=(null==t?void 0:t.layoutType)===h.GRID?s*l:s,n>i-r&&s++,s},this.handleSortOptionChange=(e,t)=>{this.setState({sortOptionName:t.label,page:1},(()=>{}))},this.handleSearchTextChange=e=>{""!==e&&e||this.handleSearchSubmit(void 0),this.setState({searchSuggestion:[]}),clearTimeout(this.suggestionsQueryTimeout),this.suggestionsQueryTimeout=setTimeout((()=>{this.getSearchSuggestions(e)}),200)},this.getSearchSuggestions=t=>{const{config:i}=this.props,{datasource:o}=this.state;if((null==t?void 0:t.length)<3)return!1;(function(t,i,o){var s;return S(this,void 0,void 0,(function*(){const n=i.searchFields.split(",");let r={page:1,pageSize:10,outFields:n,returnDistinctValues:!0};if(i.searchOpen&&i.searchFields){const e=null===(s=y(t,i,o))||void 0===s?void 0:s.sql;r.where=e;const n=o.getCurrentQueryParams();r=o.mergeQueryParams(n,r)}const l=new RegExp(`(${t})`,"gi");return function(t,i){return S(this,void 0,void 0,(function*(){return i?yield i.query(t,{scope:e.QueryScope.InConfigView}).then((e=>S(this,void 0,void 0,(function*(){return yield function(e,t){return S(this,void 0,void 0,(function*(){return yield Promise.resolve((null==t?void 0:t.records)||[])}))}(0,e)})))):yield Promise.resolve([])}))}(r,o).then((e=>S(this,void 0,void 0,(function*(){let i=[];return n.forEach((o=>{e.forEach((e=>{var s;const n=null===(s=null==e?void 0:e.feature)||void 0===s?void 0:s.attributes[o];if(n&&!i.includes(n)&&n.match(l)){const e={suggestionHtml:w(n,t),suggestion:n};i.push(e)}}))})),i=function(e,t){const i=e[0]?[e[0]]:[];for(let o=1;o<e.length;o++){const s=e[o];let n=!1;for(let e=0;e<i.length;e++)if(s[t]===i[e][t]){n=!0;break}n||i.push(s)}return i}(i,"suggestion"),Promise.resolve(i)}))))}))})(t,i,o).then((e=>{this.setState({searchSuggestion:e})}))},this.handleSearchSubmit=(e,t=!1)=>{(this.state.searchText!==e||t)&&this.setState({searchText:e,page:1},(()=>{}))},this.initNewCardSize=i=>{const{widgetRect:o}=this.state;let s=(0,e.Immutable)(i);const n=Ze(this.props);return n.width.unit===t.DistanceUnits.PERCENTAGE&&(s=s.set("width",100*i.width/o.width+"%")),n.height.unit===t.DistanceUnits.PERCENTAGE&&(s=s.set("height",100*i.height/o.height+"%")),null==s?void 0:s.asMutable({deep:!0})},this.handleFilterChange=e=>{this.setState({currentFilter:e,page:1},(()=>{}))},this.handleFilterApplyChange=e=>{const t={filterApplied:e,queryStart:0};this.setState(t,(()=>{}))},this.handleShowSelectionClick=e=>{const{showSelectionOnly:t}=this.state;this.setState({showSelectionOnly:!t})},this.handleClearSelectionClick=()=>{this.setState({showSelectionOnly:!1}),this.selectRecords([])},this.resetShowSelectionStatus=()=>{const{showSelectionOnly:e}=this.state;e&&this.setState({showSelectionOnly:!1})},this._getCurrentPage=()=>this.state.page,this.getTotalCount=()=>this.totalCount||0,this.selectCard=()=>{const{selectionIsInSelf:e}=this.props;e&&this.selectSelf()},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.editListSizeInRunTime=t=>{const{id:i,dispatch:o}=this.props;o(e.appActions.widgetStatePropChange(i,"widgetRect",t))},this.getSortItems=()=>{const{config:t}=this.props,i=[];return t.sorts&&t.sorts.forEach((e=>{e.rule&&e.rule.forEach((t=>{t&&t.jimuFieldName&&i.push({label:e.ruleOptionName,event:this.handleSortOptionChange})}))})),(0,e.Immutable)(i)},this.renderListTopTools=(i,o,s)=>{const{widgetRect:n,isSearchBoxVisible:r,isOpenTopToolsPopper:l}=this.state,a=(null==n?void 0:n.width)||620,c=it(this.props),d=tt(this.props),h=this.formatMessage("listDataActionLabel",{layer:(null==i?void 0:i.getLabel())||""}),u=c?220:175;return(0,e.jsx)("div",{className:"datasource-tools w-100",css:(this.props,p=d,e.css`
    .list-data-action {
      & {
        padding-left: ${e.polished.rem(4)};
      }
      &::after {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        height: ${e.polished.rem(16)};
        border-left: 1px solid ${p?"var(--light-400)":"transparent"}
      }
    }
    .m-left {
      margin-left: ${e.polished.rem(4)};
    }
  `)},(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 tool-row"},d&&(0,e.jsx)("div",null,a>=u&&(0,e.jsx)("div",{className:"tool-row row1 d-flex align-items-center w-100 justify-content-between"},this.renderSearchTools(i,o),(!r||a>=360)&&this.renderTopRightTools(i,o)),a<u&&(0,e.jsx)("div",{className:"float-right",ref:e=>this.reference=e},(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:this.formatMessage("guideStep9Title"),onClick:e=>{this.setState({isOpenTopToolsPopper:!l})}},(0,e.jsx)(dt,{size:16})),this.renderListTopToolsInPoper(i,o)))),i&&c&&(0,e.jsx)("div",{className:(0,e.classNames)("list-data-action position-relative",{"m-left":a<u}),"data-testid":"data-action"},(0,e.jsx)(t.DataActionDropDown,{dataName:h,type:"tertiary",widgetId:this.props.id,dataSource:i,size:"sm",records:s}))),window.jimuConfig.isInBuilder&&this.isEditing()&&(0,e.jsx)("div",{className:"editing-mask-ds-tool"}));var p},this.renderListTopToolsInPoper=(i,o)=>{const{widgetRect:s,isSearchBoxVisible:n,isOpenTopToolsPopper:r}=this.state,l=this.isEditing(),a=((null==s?void 0:s.width)||620)<(it(this.props)?220:175)&&r&&!l;return(0,e.jsx)("div",null,(0,e.jsx)(t.Popper,{placement:"bottom-start",reference:this.reference,offset:[-10,0],open:a,showArrow:!0,toggle:e=>{this.setState({isOpenTopToolsPopper:!a})}},(0,e.jsx)("div",{className:"tool-row row1 d-flex align-items-end justify-content-between",css:C(this.props)},this.renderSearchTools(i,o),!n&&this.renderTopRightTools(i,o))))},this.renderSearchTools=(i,o)=>{const s=this.isEditing()||!i||o!==e.DataSourceStatus.Loaded,{searchText:n,widgetRect:r,isSearchBoxVisible:l,showLoading:a}=this.state,c=(null==r?void 0:r.width)||620,{theme:d,config:h}=this.props,u=c<360?"ds-tools-line-blue":"",p=(null==h?void 0:h.searchHint)||this.formatMessage("search"),g=c<360&&l;return(0,e.jsx)("div",{className:"list-search-div flex-grow-1",css:I(this.props)},st(this.props)&&(0,e.jsx)("div",{className:"d-flex search-box-content"},(c>=360||l)&&(0,e.jsx)("div",{className:"flex-grow-1 w-100"},(0,e.jsx)(Z,{theme:d,placeholder:p,searchText:n,onSearchTextChange:this.handleSearchTextChange,onSubmit:this.handleSearchSubmit,disabled:s,searchSuggestion:this.state.searchSuggestion,suggestionWidth:c,showLoading:a,formatMessage:this.formatMessage,isShowBackButton:g,toggleSearchBoxVisible:this.toggleSearchBoxVisible,className:"list-search "}),(0,e.jsx)("div",{className:(0,e.classNames)("ds-tools-line",u)})),c<360&&!l&&(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.toggleSearchBoxVisible(!0)},title:this.formatMessage("search")},(0,e.jsx)(F,{size:16,color:d.colors.palette.light[800]}))))},this.toggleSearchBoxVisible=(e=!1)=>{const{widgetRect:t}=this.state;this.setState({isSearchBoxVisible:e});const i=it(this.props)?220:175;((null==t?void 0:t.width)||620)<i&&(clearTimeout(this.showPopperTimeOut),this.showPopperTimeOut=setTimeout((()=>{this.setState({isOpenTopToolsPopper:!0})})))},this.getPageSize=()=>{const{widgetRect:e}=this.state,{config:t}=this.props,i=Je(this.props,this.state),o=Xe(e,Ke(this.paginatorDiv.current,i),et(this.props))||1,s=(null==t?void 0:t.layoutType)===h.GRID?this.getItemColumnCount():null;return Math.max(Ye(e,o,this.props,s),1)},this.renderTopRightTools=(i,o)=>{const{sortOptionName:s,showSelectionOnly:n,currentFilter:r,filterApplied:l}=this.state,{config:a,theme:c,id:d,appMode:h}=this.props,u=this.getSortItems(),p=i&&i.getSelectedRecords(),g=p&&p.length>0;return(0,e.jsx)("div",{className:"d-flex align-items-center mr-1",ref:this.listTopRightToolsDiv},ot(this.props)&&(0,e.jsx)(N.Fragment,null,(0,e.jsx)(ye,{theme:c,items:u,appMode:h,toggleType:"tertiary",toggleContent:e=>s||u&&u[0].label,size:"sm",caret:!0,showActive:!0,toggleTitle:this.formatMessage("listSort"),activeLabel:s||u&&u[0].label})),nt(this.props)&&(0,e.jsx)(Te,{filter:r||a.filter,appMode:h,applied:l,title:this.formatMessage("filter"),selectedDs:this.state.datasource,handleFilterChange:this.handleFilterChange,handleFilterApplyChange:this.handleFilterApplyChange,formatMessage:this.formatMessage,theme:c,widgetId:d}),rt(this.props)&&(0,e.jsx)(t.Button,{disabled:!g,type:"tertiary",title:n?this.formatMessage("showAll"):this.formatMessage("showSelection"),icon:!0,size:"sm",onClick:this.handleShowSelectionClick},n?(0,e.jsx)(dt,{size:16}):(0,e.jsx)(mt,{size:16})),lt(this.props)&&(0,e.jsx)(t.Button,{disabled:!g,type:"tertiary",title:this.formatMessage("clearSelection"),icon:!0,size:"sm",onClick:this.handleClearSelectionClick},(0,e.jsx)(St,{size:16})))},this.renderList=(t,o)=>{const{widgetRect:s,isMount:n,currentCardSize:r}=this.state,{config:l,isRTL:a}=this.props,c=null==o?void 0:o.status;if(this.queryStatus=c,this.isHasRenderList=!0,!n)return!1;c===e.DataSourceStatus.Unloaded&&(t=void 0),this.getDsTotalCount(t,c);const d=this.getLoadingStatus(t,c),u=(null==t?void 0:t.getAutoRefreshInterval())||0;this.toggleAutoRefreshLoading(t,d);const p=Je(this.props,this.state),g=et(this.props),m=Xe(s,Ke(this.paginatorDiv.current,p),g)||1,f=s&&s.width||i,v=this.getOverscanCount(m),S=this.getDsSelectRecords(t),y=this.getDsRecords(t,d,m);this.isFirstLoad=!1,0===y.length&&this.resetShowSelectionStatus(),this.getlistInnerElementType();const w=this.getListStyle();return(0,e.jsx)("div",{"data-testid":"listContainer",className:"list-container animation",css:w},g&&this.renderListTopTools(t,c,S),(null==l?void 0:l.layoutType)===h.GRID&&(0,e.jsx)(Se,{className:"widget-list-list",ref:this.listRef,useIsScrolling:!0,outerRef:this.setListOutDivRef,direction:a?"rtl":"ltr",itemCount:this.records.length,overscanCount:v,itemKey:this.gridItemIndex,columnCount:this.getItemColumnCount(),columnWidth:(null==r?void 0:r.width)+(null==l?void 0:l.horizontalSpace),rowCount:Math.ceil(this.records.length/this.getItemColumnCount())||1,rowHeight:r.height+(null==l?void 0:l.verticalSpace),width:f,height:m,onItemsRendered:this.onItemsRendered,itemData:this.getItemsByRecords(this.records),innerElementType:this.innerElementType,onScroll:this.handleListScroll},this.itemRender),(null==l?void 0:l.layoutType)!==h.GRID&&(0,e.jsx)(ve,{className:"widget-list-list",ref:this.listRef,useIsScrolling:!0,outerRef:this.setListOutDivRef,direction:a?"rtl":"ltr",layout:l.layoutType===h.Column?"horizontal":"vertical",itemCount:this.records.length,overscanCount:v,itemKey:this.itemKey,width:f,height:m,onItemsRendered:this.onItemsRendered,itemData:this.getItemsByRecords(this.records),innerElementType:this.innerElementType,itemSize:this.itemSize,onScroll:this.handleListScroll},this.itemRender),this.checkIsShowListMask(d,y)&&(0,e.jsx)("div",{className:"editing-mask-con"},(0,e.jsx)("div",{className:"editing-mask-list"}),(null==l?void 0:l.layoutType)===h.GRID&&(0,e.jsx)("div",{className:"editing-mask-list-grid"})),p&&this.renderBottomTools(d),this.renderEmptyElement(d),c===e.DataSourceStatus.NotReady&&this.renderNotReadyTips(t),(d||u>0)&&this.renderLoading(d,u))},this.renderEmptyElement=t=>{var i;const o=!this.records||this.records.length<1,s=(null===(i=this.props.config)||void 0===i?void 0:i.noDataMessage)||this.formatMessage("noData");return!t&&o&&(0,e.jsx)("div",{className:"empty-con text-center"},(0,e.jsx)(bt,{size:16}),(0,e.jsx)("div",{className:"discribtion"},s))},this.clearMessageAction=()=>{this.handleClearSelectionClick(),e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(this.props.id,[]))},this.renderLoading=(t,i)=>{const{autoRefreshLoadingString:o}=this.state,{config:s}=this.props;let n=null==s?void 0:s.isShowAutoRefresh;return"boolean"!=typeof n&&(n=!0),(0,e.jsx)("div",{className:(0,e.classNames)("position-absolute refresh-loading-con d-flex align-items-center",this.getRefreshLoadingClass())},t&&(0,e.jsx)("div",{className:"loading-con"}),i>0&&n&&(0,e.jsx)("div",{className:"flex-grow-1 auto-refresh-loading"},o))},this.renderNotReadyTips=i=>{var o,s,n,r,l;const a=null==i?void 0:i.getLabel(),c=null===e.appConfigUtils||void 0===e.appConfigUtils?void 0:e.appConfigUtils.getWidgetIdByOutputDataSource(null===(s=null===(o=this.props)||void 0===o?void 0:o.useDataSources)||void 0===s?void 0:s[0]),d=null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig,h=null===(l=null===(r=null==d?void 0:d.widgets)||void 0===r?void 0:r[c])||void 0===l?void 0:l.label;return(0,e.jsx)("div",{className:"placeholder-alert-con"},(0,e.jsx)(t.Alert,{form:"tooltip",size:"small",type:"warning",text:this.formatMessage("outputDataIsNotGenerated",{outputDsLabel:a,sourceWidgetName:h})}))},this.renderBottomTools=t=>{const{scrollStatus:i,isScrollEnd:o}=this.state,{config:s,isRTL:n}=this.props;return(0,e.jsx)("div",{ref:this.paginatorDiv},(0,e.jsx)(Be,{isRTL:n,totalPage:this.getTotalPage(),currentPage:this._getCurrentPage(),isEditing:this.isEditing(),isScrollEnd:o,pageStyle:s.pageStyle,layoutType:null==s?void 0:s.layoutType,scrollStatus:i,handleScrollUp:this.handleScrollUp,handleScrollDown:this.handleScrollDown,handleSwitchPage:this.handleSwitchPage,formatMessage:this.formatMessage,showLoading:t}))},this.getDsTotalCount=(t,i)=>{const o=null==t?void 0:t.count;this.queryStatus=i,i===e.DataSourceStatus.Loaded&&null!==o&&(this.totalCount!==o&&(this.setPageTimeout=setTimeout((()=>{this.setState({page:1})}),1)),this.totalCount=o)},this.getLoadingStatus=(t,i)=>{const{LayoutEntry:o}=this.state,{showLoading:s}=this.props;let n=!1;return(s||window.jimuConfig.isInBuilder&&!o||t&&i===e.DataSourceStatus.Loading)&&(n=!0),n},this.toggleAutoRefreshLoading=(e,t)=>{const i=(null==e?void 0:e.getAutoRefreshInterval())||0;this.resetAutoRefreshTimes(i,t),i>0&&this.setRefreshLoadingString(t)},this.setListOutDivRef=e=>{if(!e)return;const t=`bottomBoundary${this.props.id}`;this.listOutDivRef=e,this.setListDivSize();const i=document.createElement("div");i.id=t,i.className="bottom-boundary";const o=this.listOutDivRef.getElementsByTagName("div")[0];var s,n,r;this.setScrollContentSize(),o.appendChild(i),s=document.getElementById(t),n=this.listOutDivRef,r=this.intersectionObserverCallback,new IntersectionObserver((function(e,t){const i=e[0].intersectionRatio>0;r&&r(i)}),{root:n}).observe(s)},this.getDsRecords=(t,i,o)=>{const{showSelectionOnly:s,widgetRect:n}=this.state,{config:l,appMode:a}=this.props,c=(null==l?void 0:l.layoutType)===h.GRID?this.getItemColumnCount():null,d=Ye(n,o,this.props,c),u=this.getDefaultRecords(d);let p=u;const g=this.getDsSelectRecords(t);return t&&l.isItemStyleConfirm&&(p=t&&(l.pageStyle===r.Scroll?t.getRecordsByPageWithSelection(1,d*this.state.page):t.getRecordsByPageWithSelection(this.state.page,d))||[],s&&(p=g)),window.jimuConfig.isInBuilder&&a!==e.AppMode.Run&&!i&&p.length<1&&(p=u),i&&!this.isFirstLoad||(this.records=p),p},this.getDefaultRecords=(e=3)=>{e=e&&e>1?e:3;const t=[];for(let i=0;i<e;i++)t.push(xt);return t},this.getDsSelectRecords=e=>{const{config:t}=this.props;let i;return e&&t.isItemStyleConfirm&&(i=e.getSelectedRecords()),i},this.getlistInnerElementType=()=>{const{config:t}=this.props,i=(null==t?void 0:t.layoutType)===h.GRID?null==t?void 0:t.verticalSpace:null==t?void 0:t.space;this.lastSpace!==i&&(this.lastSpace=i,this.innerElementType=(0,N.forwardRef)(((o,s)=>{var{style:n}=o,r=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(o,["style"]);return(0,e.jsx)("div",Object.assign({ref:s,style:Object.assign(Object.assign({},n),{height:parseFloat(n.height)-(t.layoutType===h.Column?0:i)+"px",width:parseFloat(n.width)-(t.layoutType!==h.Column?0:i)+"px"})},r))})))},this.getListStyle=()=>{var e,t;const{toolsDivWidth:i,currentCardSize:o,widgetRect:s}=this.state,{config:n,appMode:r,theme:l,isHeightAuto:a,isWidthAuto:c}=this.props,d=Je(this.props,this.state),h=Ke(this.paginatorDiv.current,d),u=et(this.props),p=Ge(this.props,s),g={pageStyle:null==n?void 0:n.pageStyle,scrollBarOpen:null==n?void 0:n.scrollBarOpen,direction:null==n?void 0:n.direction,appMode:r,theme:l,isHeightAuto:a,isWidthAuto:c,currentCardSize:o,listTemplateDefaultCardSize:p,showTopTools:u,bottomToolH:h,topRightToolW:i,hasRecords:(null!==(t=null===(e=this.records)||void 0===e?void 0:e.length)&&void 0!==t?t:0)>0,mexSize:this.getListMaxSize(),layoutType:null==n?void 0:n.layoutType,listLeftPadding:this.getListContentLeftPadding()};return b(g)},this.checkIsShowListMask=(e,t)=>{const{isInBuilder:i}=window.jimuConfig,o=this.isEditing(),s=!t||t.length<1;return i&&o&&!(!e&&s)},this.getOverscanCount=t=>{const{widgetRect:i}=this.state,{appMode:o,config:s}=this.props,n=(null==s?void 0:s.layoutType)===h.GRID?this.getItemColumnCount():null,r=Ye(i,t,this.props,n);return window.jimuConfig.isInBuilder&&o!==e.AppMode.Run?0:r},this.setScrollContentSize=()=>{var e;if(!this.listOutDivRef)return;const{layoutType:t}=null===(e=this.props)||void 0===e?void 0:e.config,i=this.listOutDivRef.getElementsByTagName("div")[0];t===h.Column?i.style.height="100%":i.style.width="100%"},this.intersectionObserverCallback=t=>{var i,o;const{appMode:s,config:n}=this.props,l=this.listOutDivRef,{datasource:a}=this.state;this.setState({isScrollEnd:t}),!l||(null!==(o=null===(i=this.records)||void 0===i?void 0:i.length)&&void 0!==o?o:0)<1||n.pageStyle===r.Scroll&&this.queryStatus!==e.DataSourceStatus.Loading&&a&&(!window.jimuConfig.isInBuilder||s===e.AppMode.Run&&t)&&this.isHasScrolled&&(this.records.length<this.getTotalCount()?(this.setState({page:this.state.page+1,scrollStatus:"end"}),this.isSwitchPage=!0):this.setState({scrollStatus:"end"}))},this.setListDivSize=()=>{var e;const t=this.listOutDivRef,i=(null==t?void 0:t.clientWidth)||null,o=(null==t?void 0:t.clientHeight)||null,s=(null===(e=this.listTopRightToolsDiv.current)||void 0===e?void 0:e.clientWidth)||0,n=(null==t?void 0:t.getBoundingClientRect())||null,r={clientWidth:i,clientHeight:o};this.setState({listDivSize:r,toolsDivWidth:s,listDivBoundRect:n})},this.getContentLayout=()=>{const{layoutId:t,browserSizeMode:i}=this.props,o=(0,e.getAppStore)().getState().appConfig,s=v.searchUtils.getWidgetIdThatUseTheLayoutId(o,t);return v.searchUtils.getContentLayoutInfosInOneSizeMode(o,s,e.LayoutItemType.Widget,i)},this.getContentLayoutSetting=()=>{var t,i,o,s,n;const r=(0,e.getAppStore)().getState().appConfig,{layouts:l}=r,a=this.getContentLayout(),c=null===(t=null==a?void 0:a[0])||void 0===t?void 0:t.layoutId,d=null===(i=null==a?void 0:a[0])||void 0===i?void 0:i.layoutItemId;return null===(n=null===(s=null===(o=null==l?void 0:l[c])||void 0===o?void 0:o.content)||void 0===s?void 0:s[d])||void 0===n?void 0:n.setting},this.getListMaxSize=()=>{var t,i,o,s,n;const{boundingBox:r,heightLayoutItemSizeModes:l}=this.props,a=l===v.LayoutItemSizeModes.Custom&&(null==r?void 0:r.height),c=a?null==r?void 0:r.height:this.bodySize.clientHeight,d=a&&!((null===(t=null==r?void 0:r.height)||void 0===t?void 0:t.includes)&&(null===(i=null==r?void 0:r.height)||void 0===i?void 0:i.includes("%")));let h=(0,e.Immutable)({maxWidth:this.bodySize.scrollWidth,maxHeight:c});const{layoutId:u,browserSizeMode:p,appMode:g}=this.props,m=(0,e.getAppStore)().getState().appConfig,f=e.utils.findViewportSize(m,p),{layouts:S}=m,y=null===(o=S[u])||void 0===o?void 0:o.type,w=this.getContentLayoutSetting(),b="auto"===(null===(s=null==w?void 0:w.autoProps)||void 0===s?void 0:s.width)||"auto"===(null==w?void 0:w.widthMode),x="auto"===(null===(n=null==w?void 0:w.autoProps)||void 0===n?void 0:n.height)||"auto"===(null==w?void 0:w.heightMode);if(y===e.LayoutType.ColumnLayout&&b&&(h=h.set("maxWidth",this.bodySize.clientWidth)),"ROW"===y&&x&&!d){const t=(null==f?void 0:f.height)||800,i=g===e.AppMode.Design?t:this.bodySize.clientHeight;h=h.set("maxHeight",i)}return h=h.set("maxHeight",this.initElementSize(h.maxHeight)),h=h.set("maxWidth",this.initElementSize(h.maxWidth)),h},this.initElementSize=e=>Number(e)?`${e}px`:"string"!=typeof e||(null==e?void 0:e.includes("px"))||(null==e?void 0:e.includes("rem"))?e:(null==e?void 0:e.includes("%"))?"100%":void 0,this.getRefreshLoadingClass=()=>{const{config:t,appMode:i}=this.props,{scrollBarOpen:o,layoutType:s}=t,n=window.jimuConfig.isInBuilder&&i===e.AppMode.Design;return!o||n?"":s===h.Column?"horizon-loading":"vertical-loading"},this.resetAutoRefreshTimes=(e,t=!1)=>{clearTimeout(this.resetAutoRefreshTime),e<=0&&clearInterval(this.autoRefreshLoadingTime),this.resetAutoRefreshTime=setTimeout((()=>{t&&e>0&&this.setState({autoRefreshLoadingString:this.formatMessage("lastUpdateAFewTime")}),this.setState({showLoading:t})}),0)},this.setRefreshLoadingString=(e=!1)=>{if(!e)return!1;let t=0;clearInterval(this.autoRefreshLoadingTime),this.autoRefreshLoadingTime=setInterval((()=>{t++,this.setState({autoRefreshLoadingString:this.getLoadingString(t)})}),6e4)},this.getLoadingString=e=>{let t=this.formatMessage("lastUpdateAFewTime");return e>1&&e<=2?t=this.formatMessage("lastUpdateAMinute"):e>2&&(t=this.formatMessage("lastUpdateTime",{updateTime:e})),t},this.onItemsRendered=({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:i,visibleStopIndex:o,visibleColumnStartIndex:s,visibleColumnStopIndex:n,visibleRowStartIndex:l,visibleRowStopIndex:a})=>{const{config:c}=this.props;this.listVisibleStartIndex=(null==c?void 0:c.layoutType)===h.GRID?this.getItemIndexByRowAndColumnIndex(l,s):i,this.listVisibleStopIndex=(null==c?void 0:c.layoutType)===h.GRID?this.getItemIndexByRowAndColumnIndex(a,n):o,this.needRefreshListOnListRendered&&(this.needRefreshListOnListRendered=!1,this.refreshList()),this.isSwitchPage&&(c.pageStyle===r.Scroll?this.records.length>this.listVisibleStopIndex+1&&(this.isSwitchPage=!1,this.onItemsRenderedTimeout=setTimeout((()=>{this.handleScrollDown(null)}),500)):this.isSwitchPage=!1)},this.getItemIndexByRowAndColumnIndex=(e,t)=>e*this.getItemColumnCount()+t,this.itemSize=e=>{const{config:t}=this.props,{currentCardSize:i}=this.state,o=(null==t?void 0:t.layoutType)===h.Column,s=(null==t?void 0:t.layoutType)===h.GRID?null==t?void 0:t.verticalSpace:null==t?void 0:t.space;return o?i.width+s:i.height+s},this.getItemsByRecords=t=>{const{config:i,selectionIsInSelf:o,selectionIsSelf:s,builderStatus:n,appMode:r,queryObject:l,useDataSources:a}=this.props,{datasource:c,hoverIndex:d}=this.state,h=(c&&i.isItemStyleConfirm?c.getSelectedRecordIds():[]).map((e=>e+""));return t&&t.map(((t,u)=>{const p=0===u&&window.jimuConfig.isInBuilder&&r===e.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsList:s,selectionIsInList:o,isEditing:this.isEditing(),builderStatus:n,lockItemRatio:i.lockItemRatio,changeIsResizingCard:this.changeIsResizingCard}:{linkParam:i.linkParam,queryObject:l,useDataSources:a};return Object.assign(Object.assign({index:u,isHover:d===u,record:i.isItemStyleConfirm?t:void 0,active:!t.fake&&i.isItemStyleConfirm&&c&&h.includes(t.getId())},this.getOtherProps()),p)}))},this.getOtherProps=()=>{var e,i;const{config:o,theme:s,id:r,appMode:l,builderSupportModules:a,layouts:c,browserSizeMode:d,dispatch:h,isRTL:u}=this.props,{datasource:p}=this.state,g=(null===(i=null===(e=Ze(this.props))||void 0===e?void 0:e.width)||void 0===i?void 0:i.unit)===t.DistanceUnits.PERCENTAGE;return{browserSizeMode:d,space:o.space,isRTL:u,builderSupportModules:a,formatMessage:this.formatMessage,dispatch:h,widgetId:r,interact:window.jimuConfig.isInBuilder&&a.widgetModules.interact,selectCard:this.selectCard,handleResizeCard:this.handleResizeCard,appMode:l,onChange:this.handleItemChange,hoverLayoutOpen:o.cardConfigs[f.Hover].enable,selectable:o.cardConfigs[f.Selected].selectionMode!==n.None,direction:o.direction,theme:s,LayoutEntry:this.state.LayoutEntry,layouts:c,layoutType:null==o?void 0:o.layoutType,keepAspectRatio:null==o?void 0:o.keepAspectRatio,gridItemSizeRatio:null==o?void 0:o.gridItemSizeRatio,cardConfigs:o.cardConfigs,datasourceId:p&&p.id,updateCardToolPosition:this.updateCardToolPosition,isWidthPercentage:g,horizontalSpace:null==o?void 0:o.horizontalSpace}},this.itemRender=t=>{const{appMode:i,config:o}=this.props;let s=t.style;const n=(null==t?void 0:t.columnIndex)||0,r=(null==t?void 0:t.rowIndex)||0,l=(null==o?void 0:o.layoutType)===h.GRID?this.getItemIndexByRowAndColumnIndex(r,n):t.index,a=t.data;switch(null==o?void 0:o.layoutType){case h.Column:s=Object.assign(Object.assign({},s),{width:parseFloat(s.width)-o.space+"px"});break;case h.Row:s=Object.assign(Object.assign({},s),{height:parseFloat(s.height)-o.space+"px"});break;case h.GRID:s=Object.assign(Object.assign({},s),{height:parseFloat(s.height)-(null==o?void 0:o.verticalSpace)+"px",width:parseFloat(null==s?void 0:s.width)-(null==o?void 0:o.horizontalSpace)+"px"})}const c=0===l&&window.jimuConfig.isInBuilder&&i===e.AppMode.Design?E:A;return(null==a?void 0:a.length)<l+1?null:(0,e.jsx)(c,Object.assign({listStyle:s,widgetId:this.props.id},a[l],{handleListMouseMove:this.handleListMouseMove,handleListMouseLeave:this.handleListMouseLeave,itemIdex:l}))},this.itemKey=e=>{const t=this.records[e];return`${(null==t?void 0:t.getId)&&(null==t?void 0:t.getId())||e}`},this.gridItemIndex=e=>{const{columnIndex:t,rowIndex:i}=e,o=this.getItemIndexByRowAndColumnIndex(i,t),s=this.records[o];return`${(null==s?void 0:s.getId)&&(null==s?void 0:s.getId())||o+100}`},this.getItemColumnCount=()=>{const{widgetRect:e,currentCardSize:t}=this.state,{config:o}=this.props,s=e&&e.width||i;return Math.floor((s+(null==o?void 0:o.horizontalSpace))/(t.width+(null==o?void 0:o.horizontalSpace)))||1},this.getListContentLeftPadding=()=>{const{widgetRect:e,currentCardSize:t}=this.state,{config:o}=this.props,s=((e&&e.width||i)-this.getItemColumnCount()*(t.width+(null==o?void 0:o.horizontalSpace)))/2+(null==o?void 0:o.horizontalSpace)/2;return(null==o?void 0:o.layoutType)===h.GRID&&s>0?s:0};const{config:s}=o;this.paginatorDiv=e.React.createRef(),this.listTopRightToolsDiv=e.React.createRef();const l={LayoutEntry:null,page:1,sortOptionName:s.sorts&&s.sorts[0]&&s.sorts[0].ruleOptionName,currentCardSize:Ge(o,qe(o)),forceShowMask:!1,widgetRect:qe(o),showList:!0,searchText:"",currentFilter:void 0,filterApplied:!1,showSelectionOnly:!1,hideCardTool:!1,scrollStatus:"start",datasource:void 0,hoverIndex:-1,isScrolling:!1,isScrollSpeedOver:!1,isResizingCard:!1,searchSuggestion:[],isSearchBoxVisible:!1,isOpenTopToolsPopper:!1,latestUpdateTime:0,showLoading:!1,autoRefreshLoadingString:"",listDivSize:{clientWidth:null,clientHeight:null},toolsDivWidth:null,listDivBoundRect:null,isScrollEnd:!1,isMount:!1};this.selectSelf=this.selectSelf.bind(this),this.handleResizeCard=this.handleResizeCard.bind(this),this.listRef=e.React.createRef(),window.jimuConfig.isInBuilder?l.LayoutEntry=this.props.builderSupportModules.LayoutEntry:l.LayoutEntry=v.LayoutEntry,this.state=l,this.onResize=this.onResize.bind(this),this.changeIsResizingCard=this.changeIsResizingCard.bind(this),this.setRefreshLoadingString=this.setRefreshLoadingString.bind(this),this.resetAutoRefreshTimes=this.resetAutoRefreshTimes.bind(this),this.debounceOnResize=e.lodash.debounce(((e,t)=>this.onResize(e,t)),200)}componentDidMount(){this.setState({isMount:!0}),this.getBodySize(),window.addEventListener("resize",this.getBodySize)}componentWillUnmount(){clearTimeout(this.resizeTimeout),clearTimeout(this.updateCardToolTimeout),clearTimeout(this.mouseClickTimeout),clearTimeout(this.suggestionsQueryTimeout),clearTimeout(this.showPopperTimeOut),clearTimeout(this.resetAutoRefreshTime),clearTimeout(this.setPageTimeout),clearTimeout(this.onItemsRenderedTimeout),clearInterval(this.autoRefreshLoadingTime)}componentDidUpdate(t,i){var o;const{config:s,appMode:r}=this.props,{datasource:l}=this.state;window.jimuConfig.isInBuilder&&r!==e.AppMode.Run||l&&s.cardConfigs[f.Selected].selectionMode!==n.None&&this.scrollToSelectedItems(l),this.updateListInBuilder(t,i),this.appModeChange(t),(null==t?void 0:t.selectionIsInSelf)!==(null===(o=this.props)||void 0===o?void 0:o.selectionIsInSelf)&&this.setSelectionStatus(),this.setListLayoutInWidgetState()}changeIsResizingCard(e){this.setState({isResizingCard:e})}handleResizeCard(e,t=!1,i,o,s=!1){if(t){const n=this.initNewCardSize(e);window.jimuConfig.isInBuilder&&this.props.builderSupportModules.widgetModules.handleResizeCard(this.props,n,i,o,t,s)}else this.setState({currentCardSize:e},(()=>{this.refreshList(!1)}))}selectSelf(){window.jimuConfig.isInBuilder&&this.props.builderSupportModules.widgetModules.selectSelf(this.props)}getOutputDs(){const t=this.props.outputDataSources&&this.props.outputDataSources[0],i=this.props.useDataSources&&this.props.useDataSources[0];if(t&&i)return e.DataSourceManager.getInstance().getDataSource(t)}render(){const{config:i,id:o,appMode:s,browserSizeMode:n,selectionIsInSelf:r,selectionIsSelf:a,useDataSources:c,builderStatus:d,layouts:u}=this.props,p=(0,e.getAppStore)().getState().appConfig,{forceShowMask:g,datasource:m,widgetRect:f,page:S}=this.state,w=window.jimuConfig.isInBuilder,b=(0,e.classNames)("jimu-widget","widget-list","list-widget-"+o);if(!i.itemStyle)return(0,e.jsx)(t.WidgetPlaceholder,{widgetId:this.props.id,icon:l(65354),message:this.formatMessage("placeHolderTip")});const C=Je(this.props,this.state),I=Xe(f,Ke(this.paginatorDiv.current,C),et(this.props)),R=(null==i?void 0:i.layoutType)===h.GRID?this.getItemColumnCount():null,T=Ye(f,I,this.props,R);this.pageSize=T;const M=T;let O=function(t,i,o){var s,n,r;const l={returnGeometry:!0},{config:a,stateProps:c,useDataSources:d}=i,{sortOptionName:h,searchText:u,currentFilter:p,filterApplied:g,datasource:m}=t,f=d&&d[0];if(!m||!f)return null;if(!m.query)return null;let v;if(a.sortOpen&&a.sorts&&(v=a.sorts.find((e=>e.ruleOptionName===h)),v=v||a.sorts[0],(null===(n=null===(s=null==v?void 0:v.rule)||void 0===s?void 0:s[0])||void 0===n?void 0:n.jimuFieldName)||(v=void 0),v)){const e=[];v.rule.forEach((t=>{t.jimuFieldName&&e.push(`${t.jimuFieldName} ${t.order}`)})),l.orderByFields=e}if(a.filterOpen&&g&&a.filter&&p&&p.sql&&(l.where=(l.where||"1=1")+" AND ",l.where+=`(${p.sql})`),c){const t=null==c?void 0:c[e.MessageType.ExtentChange];t&&(l.geometry=t.queryExtent,t.querySQL&&(l.where=(l.where||"1=1")+" AND ",l.where+=`(${t.querySQL})`));const i=c[e.MessageType.DataRecordsSelectionChange];i&&i.querySQL&&(l.where=(l.where||"1=1")+" AND ",l.where+=`(${i.querySQL})`)}if(a.searchOpen&&a.searchFields&&u){l.where=(l.where||"1=1")+" AND ";const e=null===(r=y(u,a,m))||void 0===r?void 0:r.sql;l.where+=e}return o>0&&(l.page=t.page,l.pageSize=o),l}(this.state,this.props,M);if(!function(t,i,o){return!!o&&(t=o.getRealQueryParams(t,"query"),i=o.getRealQueryParams(i,"query"),!(!t||!i)&&(delete t.page,delete t.pageSize,delete t.resultOffset,delete t.resultRecordCount,delete i.page,delete i.pageSize,delete i.resultOffset,delete i.resultRecordCount,e.utils.isDeepEqual(t,i)))}(O,this.lastQuery,m)&&m){const e=O;1!==S?(O=this.lastQuery,this.lastQuery=e,this.setState({page:1})):this.lastQuery=e}const L=null==p?void 0:p.layouts[v.searchUtils.findLayoutId(u[d],n,p.mainSizeMode)],j=L&&L.type;return(0,e.jsx)("div",{className:b,css:x(this.props,this.isEditing(),C),onPointerDown:t=>w&&s!==e.AppMode.Run&&!a&&!r&&this.handleListPointerDown(t)},(0,e.jsx)("div",{className:"widget-list d-flex"},this.isDsConfigured()?(0,e.jsx)(e.DataSourceComponent,{query:m?O:null,useDataSource:c&&c[0],onDataSourceCreated:this.onDSCreated,widgetId:this.props.id,queryCount:!0},this.renderList):this.renderList(),!this.isHasRenderList&&(0,e.jsx)("div",{className:"list-loading-con w-100 h-100"},(0,e.jsx)("div",{className:"jimu-secondary-loading"}))),w&&s!==e.AppMode.Run&&(g||!r&&!a||!i.isItemStyleConfirm&&j)&&(0,e.jsx)("div",{className:"list-with-mask"}),(0,e.jsx)(e.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize}))}}It.versionManager=Fe,It.mapExtraStateProps=(e,t)=>{var i,o,s,n,r,l,a,c,d,h,u,p,g,m,S,y,w;const b=e&&e.appConfig,{layouts:x,layoutId:C,layoutItemId:I,builderSupportModules:R,id:T}=t,M=e&&e.browserSizeMode,O=e&&e.widgetsState&&e.widgetsState[t.id]&&e.widgetsState[t.id].builderStatus||f.Regular;let L;if(b){const t=b&&e.appConfig.layouts&&e.appConfig.layouts[v.searchUtils.findLayoutId(x[O],M,b.mainSizeMode)];L=t&&t.type}const j=null===(i=b.layouts)||void 0===i?void 0:i[C],D=null===(s=null===(o=null==j?void 0:j.content)||void 0===o?void 0:o[I])||void 0===s?void 0:s.setting,z=(null===(n=null==D?void 0:D.autoProps)||void 0===n?void 0:n.height)===v.LayoutItemSizeModes.Auto||!0===(null===(r=null==D?void 0:D.autoProps)||void 0===r?void 0:r.height),k=(null===(l=null==D?void 0:D.autoProps)||void 0===l?void 0:l.width)===v.LayoutItemSizeModes.Auto||!0===(null===(a=null==D?void 0:D.autoProps)||void 0===a?void 0:a.width);let P;if(window.jimuConfig.isInBuilder){const e=null===(u=null===(h=null===(d=null===(c=b.layouts)||void 0===c?void 0:c[C])||void 0===d?void 0:d.content)||void 0===h?void 0:h[I])||void 0===u?void 0:u.bbox;P=e&&{left:e.left,top:e.top}}const E=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,N=E&&R&&R.widgetModules&&R.widgetModules.selectionInList(E,T,b,!1);let A;return N&&(A=Object.keys(x).find((e=>v.searchUtils.findLayoutId(x[e],M,b.mainSizeMode)===E.layoutId))),{selectionIsSelf:!(!E||E.layoutId!==C||E.layoutItemId!==I),selectionIsInSelf:!!N,selectionStatus:A,appMode:null===(p=null==e?void 0:e.appRuntimeInfo)||void 0===p?void 0:p.appMode,browserSizeMode:e&&e.browserSizeMode,builderStatus:e&&e.widgetsState&&e.widgetsState[t.id]&&e.widgetsState[t.id].builderStatus||f.Regular,showLoading:null===(m=null===(g=null==e?void 0:e.widgetsState)||void 0===g?void 0:g[t.id])||void 0===m?void 0:m.showLoading,isRTL:e&&e.appContext&&e.appContext.isRTL,subLayoutType:L,left:P&&P.left,top:P&&P.top,isHeightAuto:z,isWidthAuto:k,queryObject:e.queryObject,boundingBox:null===(y=null===(S=null==j?void 0:j.content)||void 0===S?void 0:S[I])||void 0===y?void 0:y.bbox,heightLayoutItemSizeModes:null===(w=null==D?void 0:D.autoProps)||void 0===w?void 0:w.height}};const Rt=It})(),a})())}}}));